{"ast":null,"code":"import { BehaviorSubject, throwError } from 'rxjs';\nimport { catchError, tap, map } from 'rxjs/operators';\nimport { JwtHelperService } from '@auth0/angular-jwt';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AutenticacionServicio {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.apiUrl = `${environment.apiUrl}/auth`;\n    this.usuarioSubject = new BehaviorSubject(null);\n    this.usuario$ = this.usuarioSubject.asObservable();\n    this.jwtHelper = new JwtHelperService();\n    this.autoLogin();\n  }\n  registrar(datosRegistro) {\n    return this.http.post(`${this.apiUrl}/register`, datosRegistro).pipe(catchError(this.manejarError), tap(respuesta => {\n      const datosAuth = respuesta.data;\n      this.manejarAutenticacion(datosAuth);\n    }), map(respuesta => respuesta.data));\n  }\n  login(datosLogin) {\n    return this.http.post(`${this.apiUrl}/login`, datosLogin).pipe(catchError(this.manejarError), tap(respuesta => {\n      const datosAuth = respuesta.data;\n      this.manejarAutenticacion(datosAuth);\n    }), map(respuesta => respuesta.data));\n  }\n  logout() {\n    localStorage.removeItem('userData');\n    this.usuarioSubject.next(null);\n    this.router.navigate(['/login']);\n    if (this.temporizadorExpiracionToken) {\n      clearTimeout(this.temporizadorExpiracionToken);\n    }\n    this.temporizadorExpiracionToken = null;\n  }\n  autoLogin() {\n    const userData = localStorage.getItem('userData');\n    if (!userData) {\n      return;\n    }\n    const datosParseados = JSON.parse(userData);\n    const token = datosParseados._token;\n    if (this.jwtHelper.isTokenExpired(token)) {\n      this.logout();\n      return;\n    }\n    const fechaExpiracion = new Date(datosParseados._tokenExpirationDate);\n    if (fechaExpiracion <= new Date()) {\n      this.logout();\n      return;\n    }\n    const usuario = {\n      id: datosParseados.id,\n      name: datosParseados.name,\n      email: datosParseados.email,\n      role: datosParseados.role,\n      studentId: datosParseados.studentId ? typeof datosParseados.studentId === 'string' ? parseInt(datosParseados.studentId, 10) : datosParseados.studentId : undefined,\n      professorId: datosParseados.professorId ? typeof datosParseados.professorId === 'string' ? parseInt(datosParseados.professorId, 10) : datosParseados.professorId : undefined\n    };\n    this.usuarioSubject.next(usuario);\n    const duracionExpiracion = fechaExpiracion.getTime() - new Date().getTime();\n    this.autoLogout(duracionExpiracion);\n  }\n  autoLogout(duracionExpiracion) {\n    this.temporizadorExpiracionToken = setTimeout(() => {\n      this.logout();\n    }, duracionExpiracion);\n  }\n  obtenerToken() {\n    const userData = localStorage.getItem('userData');\n    if (!userData) {\n      return null;\n    }\n    const datosParseados = JSON.parse(userData);\n    return datosParseados._token;\n  }\n  estaAutenticado() {\n    const token = this.obtenerToken();\n    if (!token) {\n      return false;\n    }\n    return !this.jwtHelper.isTokenExpired(token);\n  }\n  esEstudiante() {\n    return this.usuarioSubject.value?.role === 'student';\n  }\n  esAdmin() {\n    return this.usuarioSubject.value?.role === 'admin';\n  }\n  esProfesor() {\n    return this.usuarioSubject.value?.role === 'professor';\n  }\n  obtenerIdUsuarioActual() {\n    return this.usuarioSubject.value?.id || null;\n  }\n  obtenerUsuarioActualId() {\n    return this.usuarioSubject.value?.id || null;\n  }\n  manejarAutenticacion(datosAuth) {\n    const tokenDecodificado = this.jwtHelper.decodeToken(datosAuth.token);\n    const fechaExpiracion = new Date(tokenDecodificado.exp * 1000);\n    // Extraer studentId y professorId del token decodificado\n    const studentId = tokenDecodificado.studentId ? typeof tokenDecodificado.studentId === 'string' ? parseInt(tokenDecodificado.studentId, 10) : tokenDecodificado.studentId : undefined;\n    const professorId = tokenDecodificado.professorId ? typeof tokenDecodificado.professorId === 'string' ? parseInt(tokenDecodificado.professorId, 10) : tokenDecodificado.professorId : undefined;\n    const usuario = {\n      id: datosAuth.userId,\n      name: datosAuth.name,\n      email: datosAuth.email,\n      role: datosAuth.role,\n      studentId: studentId,\n      professorId: professorId\n    };\n    const userData = {\n      ...usuario,\n      _token: datosAuth.token,\n      _tokenExpirationDate: fechaExpiracion.toISOString()\n    };\n    console.log('Guardando datos de usuario:', userData);\n    localStorage.setItem('userData', JSON.stringify(userData));\n    this.usuarioSubject.next(usuario);\n    this.autoLogout(datosAuth.expiresIn * 1000);\n  }\n  obtenerPerfilUsuario(userId) {\n    return this.http.get(`${this.apiUrl}/profile/${userId}`).pipe(catchError(this.manejarError), map(respuesta => respuesta.data));\n  }\n  manejarError(errorRes) {\n    let mensajeError = '¡Ocurrió un error desconocido!';\n    if (!errorRes.error || !errorRes.error.message) {\n      return throwError(() => new Error(mensajeError));\n    }\n    return throwError(() => new Error(errorRes.error.message));\n  }\n  obtenerUsuarioActual() {\n    return this.usuario$;\n  }\n  obtenerValorUsuarioActual() {\n    return this.usuarioSubject.value;\n  }\n  static {\n    this.ɵfac = function AutenticacionServicio_Factory(t) {\n      return new (t || AutenticacionServicio)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AutenticacionServicio,\n      factory: AutenticacionServicio.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["BehaviorSubject","throwError","catchError","tap","map","JwtHelperService","environment","AutenticacionServicio","constructor","http","router","apiUrl","usuarioSubject","asObservable","autoLogin","registrar","datosRegistro","post","pipe","manejarError","respuesta","datosAuth","data","manejarAutenticacion","login","datosLogin","logout","localStorage","removeItem","next","navigate","temporizadorExpiracionToken","clearTimeout","userData","getItem","datosParseados","JSON","parse","token","_token","jwtHelper","isTokenExpired","fechaExpiracion","Date","_tokenExpirationDate","usuario","id","name","email","role","studentId","parseInt","undefined","professorId","duracionExpiracion","getTime","autoLogout","setTimeout","obtenerToken","estaAutenticado","esEstudiante","value","esAdmin","esProfesor","obtenerIdUsuarioActual","obtenerUsuarioActualId","tokenDecodificado","decodeToken","exp","userId","toISOString","console","log","setItem","stringify","expiresIn","obtenerPerfilUsuario","get","errorRes","mensajeError","error","message","Error","obtenerUsuarioActual","usuario$","obtenerValorUsuarioActual","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\hansk\\Videos\\frontendsistemacolegio.interrapidisi\\frontendsistemacolegio.interrapidisi\\src\\app\\servicios\\autenticacion.servicio.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\nimport { catchError, tap, map } from 'rxjs/operators';\nimport { LoginRequest, RegisterRequest, AuthResponse, UserProfile } from '../models/auth.model';\nimport { Router } from '@angular/router';\nimport { JwtHelperService } from '@auth0/angular-jwt';\nimport { environment } from '../../environments/environment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AutenticacionServicio {\n  private apiUrl = `${environment.apiUrl}/auth`;\n  private temporizadorExpiracionToken: any;\n  private usuarioSubject = new BehaviorSubject<UserProfile | null>(null);\n  usuario$ = this.usuarioSubject.asObservable();\n  private jwtHelper = new JwtHelperService();\n\n  constructor(private http: HttpClient, private router: Router) {\n    this.autoLogin();\n  }\n\n  registrar(datosRegistro: RegisterRequest): Observable<AuthResponse> {\n    return this.http.post<any>(`${this.apiUrl}/register`, datosRegistro)\n      .pipe(\n        catchError(this.manejarError),\n        tap(respuesta => {\n          const datosAuth = respuesta.data;\n          this.manejarAutenticacion(datosAuth);\n        }),\n        map(respuesta => respuesta.data)\n      );\n  }\n\n  login(datosLogin: LoginRequest): Observable<AuthResponse> {\n    return this.http.post<any>(`${this.apiUrl}/login`, datosLogin)\n      .pipe(\n        catchError(this.manejarError),\n        tap(respuesta => {\n          const datosAuth = respuesta.data;\n          this.manejarAutenticacion(datosAuth);\n        }),\n        map(respuesta => respuesta.data)\n      );\n  }\n\n  logout() {\n    localStorage.removeItem('userData');\n    this.usuarioSubject.next(null);\n    this.router.navigate(['/login']);\n    if (this.temporizadorExpiracionToken) {\n      clearTimeout(this.temporizadorExpiracionToken);\n    }\n    this.temporizadorExpiracionToken = null;\n  }\n\n  autoLogin() {\n    const userData = localStorage.getItem('userData');\n    if (!userData) {\n      return;\n    }\n    const datosParseados: any = JSON.parse(userData);\n    const token = datosParseados._token;\n    if (this.jwtHelper.isTokenExpired(token)) {\n      this.logout();\n      return;\n    }\n    const fechaExpiracion = new Date(datosParseados._tokenExpirationDate);\n    if (fechaExpiracion <= new Date()) {\n      this.logout();\n      return;\n    }\n    const usuario: UserProfile = {\n      id: datosParseados.id,\n      name: datosParseados.name,\n      email: datosParseados.email,\n      role: datosParseados.role,\n      studentId: datosParseados.studentId ? (typeof datosParseados.studentId === 'string' ? parseInt(datosParseados.studentId, 10) : datosParseados.studentId) : undefined,\n      professorId: datosParseados.professorId ? (typeof datosParseados.professorId === 'string' ? parseInt(datosParseados.professorId, 10) : datosParseados.professorId) : undefined\n    };\n    this.usuarioSubject.next(usuario);\n    const duracionExpiracion = fechaExpiracion.getTime() - new Date().getTime();\n    this.autoLogout(duracionExpiracion);\n  }\n\n  autoLogout(duracionExpiracion: number) {\n    this.temporizadorExpiracionToken = setTimeout(() => {\n      this.logout();\n    }, duracionExpiracion);\n  }\n\n  obtenerToken(): string | null {\n    const userData = localStorage.getItem('userData');\n    if (!userData) {\n      return null;\n    }\n    const datosParseados = JSON.parse(userData);\n    return datosParseados._token;\n  }\n\n  estaAutenticado(): boolean {\n    const token = this.obtenerToken();\n    if (!token) {\n      return false;\n    }\n    return !this.jwtHelper.isTokenExpired(token);\n  }\n\n  esEstudiante(): boolean {\n    return this.usuarioSubject.value?.role === 'student';\n  }\n\n  esAdmin(): boolean {\n    return this.usuarioSubject.value?.role === 'admin';\n  }\n\n  esProfesor(): boolean {\n    return this.usuarioSubject.value?.role === 'professor';\n  }\n\n  obtenerIdUsuarioActual(): number | null {\n    return this.usuarioSubject.value?.id || null;\n  }\n\n  obtenerUsuarioActualId(): number | null {\n    return this.usuarioSubject.value?.id || null;\n  }\n\n  private manejarAutenticacion(datosAuth: AuthResponse) {\n    const tokenDecodificado = this.jwtHelper.decodeToken(datosAuth.token);\n    const fechaExpiracion = new Date(tokenDecodificado.exp * 1000);\n    \n    // Extraer studentId y professorId del token decodificado\n    const studentId = tokenDecodificado.studentId ? \n      (typeof tokenDecodificado.studentId === 'string' ? \n        parseInt(tokenDecodificado.studentId, 10) : tokenDecodificado.studentId) : undefined;\n    \n    const professorId = tokenDecodificado.professorId ? \n      (typeof tokenDecodificado.professorId === 'string' ? \n        parseInt(tokenDecodificado.professorId, 10) : tokenDecodificado.professorId) : undefined;\n    \n    const usuario: UserProfile = {\n      id: datosAuth.userId,\n      name: datosAuth.name,\n      email: datosAuth.email,\n      role: datosAuth.role,\n      studentId: studentId,\n      professorId: professorId\n    };\n    \n    const userData = {\n      ...usuario,\n      _token: datosAuth.token,\n      _tokenExpirationDate: fechaExpiracion.toISOString()\n    };\n    \n    console.log('Guardando datos de usuario:', userData);\n    localStorage.setItem('userData', JSON.stringify(userData));\n    this.usuarioSubject.next(usuario);\n    this.autoLogout(datosAuth.expiresIn * 1000);\n  }\n\n  obtenerPerfilUsuario(userId: number): Observable<UserProfile> {\n    return this.http.get<any>(`${this.apiUrl}/profile/${userId}`)\n      .pipe(\n        catchError(this.manejarError),\n        map(respuesta => respuesta.data)\n      );\n  }\n\n  private manejarError(errorRes: any) {\n    let mensajeError = '¡Ocurrió un error desconocido!';\n    if (!errorRes.error || !errorRes.error.message) {\n      return throwError(() => new Error(mensajeError));\n    }\n    return throwError(() => new Error(errorRes.error.message));\n  }\n\n  obtenerUsuarioActual(): Observable<UserProfile | null> {\n    return this.usuario$;\n  }\n\n  obtenerValorUsuarioActual(): UserProfile | null {\n    return this.usuarioSubject.value;\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}