{"ast":null,"code":"import { Observable, throwError, of } from 'rxjs';\nimport { catchError, map, switchMap } from 'rxjs/operators';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./asignatura.servicio\";\nimport * as i3 from \"./autenticacion.servicio\";\nexport class InscripcionServicio {\n  constructor(http, asignaturaServicio, autenticacionServicio) {\n    this.http = http;\n    this.asignaturaServicio = asignaturaServicio;\n    this.autenticacionServicio = autenticacionServicio;\n    this.apiUrl = `${environment.apiUrl}/Registros`;\n    this.MAX_ASIGNATURAS = 3;\n  }\n  obtenerInscripcionesEstudiante(estudianteId) {\n    console.log(estudianteId);\n    return this.http.get(`${this.apiUrl}/estudiante/${estudianteId}`).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        console.log('Procesando inscripciones del estudiante:', respuesta.data);\n        return respuesta.data.map(item => ({\n          id: item.id,\n          estudianteId: item.estudianteId,\n          asignaturaId: item.materiaId,\n          fechaInscripcion: new Date(item.fechaRegistro),\n          estudiante: item.nombreEstudiante ? {\n            id: item.estudianteId,\n            nombre: item.nombreEstudiante,\n            matricula: '',\n            email: ''\n          } : undefined,\n          asignatura: item.nombreMateria ? {\n            id: item.materiaId,\n            nombre: item.nombreMateria,\n            codigo: '',\n            creditos: 0,\n            profesorId: 0\n          } : undefined\n        }));\n      }\n      return [];\n    }), catchError(this.manejarError));\n  }\n  obtenerInscripcionesAsignatura(asignaturaId) {\n    return this.http.get(`${this.apiUrl}/materia/${asignaturaId}`).pipe(map(respuesta => {\n      console.log('Obteniendo inscripciones para la asignatura:', asignaturaId);\n      if (respuesta && respuesta.exito && respuesta.data) {\n        console.log('Datos de inscripciones obtenidos:', respuesta.data);\n        return respuesta.data.map(item => ({\n          id: item.id,\n          estudianteId: item.estudianteId,\n          asignaturaId: item.materiaId,\n          fechaInscripcion: new Date(item.fechaRegistro),\n          estudiante: item.nombreEstudiante ? {\n            id: item.estudianteId,\n            nombre: item.nombreEstudiante,\n            matricula: '',\n            email: ''\n          } : undefined,\n          asignatura: item.nombreMateria ? {\n            id: item.materiaId,\n            nombre: item.nombreMateria,\n            codigo: '',\n            creditos: item.creditos,\n            profesorId: 0\n          } : undefined\n        }));\n      }\n      return [];\n    }), catchError(this.manejarError));\n  }\n  obtenerInscripcion(id) {\n    return this.http.get(`${this.apiUrl}/${id}`).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        const item = respuesta.data;\n        return {\n          id: item.id,\n          estudianteId: item.estudianteId,\n          asignaturaId: item.materiaId,\n          fechaInscripcion: new Date(item.fechaRegistro),\n          estudiante: item.nombreEstudiante ? {\n            id: item.estudianteId,\n            nombre: item.nombreEstudiante,\n            matricula: '',\n            correo: ''\n          } : undefined,\n          asignatura: item.nombreMateria ? {\n            id: item.materiaId,\n            nombre: item.nombreMateria,\n            codigo: '',\n            creditos: 0,\n            profesorId: 0\n          } : undefined\n        };\n      }\n      throw new Error('Inscripción no encontrada');\n    }), catchError(this.manejarError));\n  }\n  inscribirAsignatura(solicitud) {\n    const estudianteId = solicitud.estudianteId;\n    return this.obtenerInscripcionesEstudiante(estudianteId).pipe(switchMap(inscripciones => {\n      if (inscripciones.length >= this.MAX_ASIGNATURAS) {\n        return throwError(() => new Error('No puedes inscribirte en más de 3 asignaturas'));\n      }\n      const asignaturasRegistradasIds = inscripciones.map(i => i.asignaturaId);\n      if (asignaturasRegistradasIds.includes(solicitud.asignaturaId)) {\n        return throwError(() => new Error('Ya estás inscrito en esta asignatura'));\n      }\n      if (asignaturasRegistradasIds.length === 0) {\n        const solicitudBackend = {\n          estudianteId: solicitud.estudianteId,\n          nombreEstudiante: solicitud.nombreEstudiante || '',\n          materiaId: solicitud.asignaturaId,\n          nombreMateria: solicitud.nombreAsignatura || '',\n          fechaRegistro: new Date()\n        };\n        return this.http.post(this.apiUrl, solicitudBackend).pipe(map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            const item = respuesta.data;\n            return {\n              id: item.id,\n              estudianteId: item.estudianteId,\n              asignaturaId: item.materiaId,\n              fechaInscripcion: new Date(item.fechaRegistro),\n              estudiante: item.nombreEstudiante ? {\n                id: item.estudianteId,\n                nombre: item.nombreEstudiante,\n                matricula: '',\n                correo: ''\n              } : undefined,\n              asignatura: item.nombreMateria ? {\n                id: item.materiaId,\n                nombre: item.nombreMateria,\n                codigo: '',\n                creditos: 0,\n                profesorId: 0\n              } : undefined\n            };\n          }\n          throw new Error('Error al registrar la asignatura');\n        }), catchError(this.manejarError));\n      }\n      return this.asignaturaServicio.obtenerAsignatura(solicitud.asignaturaId).pipe(switchMap(nuevaAsignatura => {\n        return this.asignaturaServicio.obtenerAsignaturasPorIds(asignaturasRegistradasIds).pipe(switchMap(asignaturasRegistradas => {\n          const profesoresIds = asignaturasRegistradas.map(a => a.profesorId);\n          if (profesoresIds.includes(nuevaAsignatura.profesorId)) {\n            return throwError(() => new Error('No puedes tener más de una asignatura con el mismo profesor'));\n          }\n          const solicitudBackend = {\n            estudianteId: solicitud.estudianteId,\n            nombreEstudiante: solicitud.nombreEstudiante || '',\n            materiaId: solicitud.asignaturaId,\n            nombreMateria: solicitud.nombreAsignatura || '',\n            fechaRegistro: new Date()\n          };\n          return this.http.post(this.apiUrl, solicitudBackend).pipe(map(respuesta => {\n            if (respuesta && respuesta.exito && respuesta.data) {\n              const item = respuesta.data;\n              return {\n                id: item.id,\n                estudianteId: item.estudianteId,\n                asignaturaId: item.materiaId,\n                fechaInscripcion: new Date(item.fechaRegistro),\n                estudiante: item.nombreEstudiante ? {\n                  id: item.estudianteId,\n                  nombre: item.nombreEstudiante,\n                  matricula: '',\n                  correo: ''\n                } : undefined,\n                asignatura: item.nombreMateria ? {\n                  id: item.materiaId,\n                  nombre: item.nombreMateria,\n                  codigo: '',\n                  creditos: 0,\n                  profesorId: 0\n                } : undefined\n              };\n            }\n            throw new Error('Error al registrar la asignatura');\n          }), catchError(this.manejarError));\n        }));\n      }));\n    }));\n  }\n  desinscribirAsignatura(inscripcionId) {\n    return this.http.delete(`${this.apiUrl}/${inscripcionId}`).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito) {\n        return respuesta.data;\n      }\n      throw new Error('Error al eliminar la inscripción');\n    }), catchError(this.manejarError));\n  }\n  obtenerCompaneros(asignaturaId, estudianteId) {\n    return this.http.get(`${this.apiUrl}/materia/${asignaturaId}`).pipe(map(response => {\n      if (response && response.exito && response.data) {\n        return response.data.map(item => ({\n          id: item.id,\n          studentId: item.estudianteId,\n          subjectId: item.materiaId,\n          registrationDate: new Date(item.fechaRegistro),\n          student: item.nombreEstudiante ? {\n            id: item.estudianteId,\n            name: item.nombreEstudiante,\n            studentId: '',\n            email: ''\n          } : undefined,\n          subject: item.nombreMateria ? {\n            id: item.materiaId,\n            name: item.nombreMateria,\n            code: '',\n            credits: 0,\n            professorId: 0\n          } : undefined\n        }));\n      }\n      return [];\n    }), catchError(this.manejarError));\n  }\n  registrarAsignatura(solicitud) {\n    const estudianteId = solicitud.estudianteId;\n    return this.obtenerInscripcionesEstudiante(estudianteId).pipe(switchMap(inscripciones => {\n      if (inscripciones.length >= this.MAX_ASIGNATURAS) {\n        return throwError(() => new Error('No puedes inscribirte en más de 3 asignaturas'));\n      }\n      const asignaturasRegistradasIds = inscripciones.map(i => i.asignaturaId);\n      if (asignaturasRegistradasIds.includes(solicitud.asignaturaId)) {\n        return throwError(() => new Error('Ya estás inscrito en esta asignatura'));\n      }\n      if (asignaturasRegistradasIds.length === 0) {\n        const solicitudBackend = {\n          estudianteId: solicitud.estudianteId,\n          nombreEstudiante: solicitud.nombreEstudiante || '',\n          materiaId: solicitud.asignaturaId,\n          nombreMateria: solicitud.nombreAsignatura || '',\n          fechaRegistro: new Date()\n        };\n        return this.http.post(this.apiUrl, solicitudBackend).pipe(map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            const item = respuesta.data;\n            return {\n              id: item.id,\n              estudianteId: item.estudianteId,\n              asignaturaId: item.materiaId,\n              fechaInscripcion: new Date(item.fechaRegistro),\n              estudiante: item.nombreEstudiante ? {\n                id: item.estudianteId,\n                nombre: item.nombreEstudiante,\n                matricula: '',\n                correo: ''\n              } : undefined,\n              asignatura: item.nombreMateria ? {\n                id: item.materiaId,\n                nombre: item.nombreMateria,\n                codigo: '',\n                creditos: 0,\n                profesorId: 0\n              } : undefined\n            };\n          }\n          throw new Error('Error al registrar la asignatura');\n        }), catchError(this.manejarError));\n      }\n      return this.asignaturaServicio.obtenerAsignatura(solicitud.asignaturaId).pipe(switchMap(nuevaAsignatura => {\n        return this.asignaturaServicio.obtenerAsignaturasPorIds(asignaturasRegistradasIds).pipe(switchMap(asignaturasRegistradas => {\n          const profesoresIds = asignaturasRegistradas.map(a => a.profesorId);\n          if (profesoresIds.includes(nuevaAsignatura.profesorId)) {\n            return throwError(() => new Error('No puedes tener más de una asignatura con el mismo profesor'));\n          }\n          const solicitudBackend = {\n            estudianteId: solicitud.estudianteId,\n            nombreEstudiante: solicitud.nombreEstudiante || '',\n            materiaId: solicitud.asignaturaId,\n            nombreMateria: solicitud.nombreAsignatura || '',\n            fechaRegistro: new Date()\n          };\n          return this.http.post(this.apiUrl, solicitudBackend).pipe(map(respuesta => {\n            if (respuesta && respuesta.exito && respuesta.data) {\n              const item = respuesta.data;\n              return {\n                id: item.id,\n                estudianteId: item.estudianteId,\n                asignaturaId: item.materiaId,\n                fechaInscripcion: new Date(item.fechaRegistro),\n                estudiante: item.nombreEstudiante ? {\n                  id: item.estudianteId,\n                  nombre: item.nombreEstudiante,\n                  matricula: '',\n                  correo: ''\n                } : undefined,\n                asignatura: item.nombreMateria ? {\n                  id: item.materiaId,\n                  nombre: item.nombreMateria,\n                  codigo: '',\n                  creditos: 0,\n                  profesorId: 0\n                } : undefined\n              };\n            }\n            throw new Error('Error al registrar la asignatura');\n          }), catchError(this.manejarError));\n        }));\n      }));\n    }));\n  }\n  puedeAccederSeccionEstudiante() {\n    return this.autenticacionServicio.obtenerUsuarioActual().pipe(map(user => {\n      // Solo los administradores y profesores pueden acceder a la sección de estudiantes\n      return user?.role === 'admin' || user?.role === 'professor';\n    }), catchError(() => of(false)));\n  }\n  obtenerTotalCreditosEstudiante(studentId) {\n    return this.obtenerInscripcionesEstudiante(studentId).pipe(switchMap(registrations => {\n      if (registrations.length === 0) {\n        return new Observable(observer => {\n          observer.next(0);\n          observer.complete();\n        });\n      }\n      const subjectIds = registrations.map(r => r.asignaturaId);\n      return this.asignaturaServicio.obtenerAsignaturasPorIds(subjectIds).pipe(map(subjects => {\n        return subjects.reduce((total, subject) => total + subject.creditos, 0);\n      }));\n    }), catchError(this.manejarError));\n  }\n  manejarError(error) {\n    let mensajeError = '¡Ocurrió un error desconocido!';\n    if (error.error instanceof ErrorEvent) {\n      mensajeError = `Error: ${error.error.message}`;\n    } else if (error.error && error.error.message) {\n      mensajeError = error.error.message;\n    } else if (error.status) {\n      mensajeError = `Error ${error.status}: ${error.statusText}`;\n    }\n    return throwError(() => new Error(mensajeError));\n  }\n  static {\n    this.ɵfac = function InscripcionServicio_Factory(t) {\n      return new (t || InscripcionServicio)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AsignaturaServicio), i0.ɵɵinject(i3.AutenticacionServicio));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: InscripcionServicio,\n      factory: InscripcionServicio.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["Observable","throwError","of","catchError","map","switchMap","environment","InscripcionServicio","constructor","http","asignaturaServicio","autenticacionServicio","apiUrl","obtenerInscripcionesEstudiante","estudianteId","console","log","get","pipe","respuesta","exito","data","item","id","asignaturaId","materiaId","fechaInscripcion","Date","fechaRegistro","estudiante","nombreEstudiante","nombre","matricula","email","undefined","asignatura","nombreMateria","codigo","creditos","profesorId","manejarError","obtenerInscripcionesAsignatura","obtenerInscripcion","correo","Error","inscribirAsignatura","solicitud","inscripciones","length","MAX_ASIGNATURAS","asignaturasRegistradasIds","i","includes","solicitudBackend","nombreAsignatura","post","obtenerAsignatura","nuevaAsignatura","obtenerAsignaturasPorIds","asignaturasRegistradas","profesoresIds","a","desinscribirAsignatura","inscripcionId","delete","obtenerCompaneros","response","studentId","subjectId","registrationDate","student","name","subject","code","credits","professorId","registrarAsignatura","puedeAccederSeccionEstudiante","obtenerUsuarioActual","user","role","obtenerTotalCreditosEstudiante","registrations","observer","next","complete","subjectIds","r","subjects","reduce","total","error","mensajeError","ErrorEvent","message","status","statusText","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\hansk\\Videos\\frontendsistemacolegio.interrapidisi\\frontendsistemacolegio.interrapidisi\\src\\app\\servicios\\inscripcion.servicio.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, throwError, forkJoin, of } from 'rxjs';\nimport { catchError, map, switchMap } from 'rxjs/operators';\nimport { Inscripcion, SolicitudInscripcion } from '../modelos/inscripcion.modelo';\nimport { Asignatura } from '../modelos/asignatura.modelo';\nimport { Estudiante } from '../modelos/estudiante.modelo';\nimport { AsignaturaServicio } from './asignatura.servicio';\nimport { AutenticacionServicio } from './autenticacion.servicio';\nimport { environment } from '../../environments/environment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InscripcionServicio {\n  private apiUrl = `${environment.apiUrl}/Registros`;\n  private MAX_ASIGNATURAS = 3;\n\n  constructor(\n    private http: HttpClient,\n    private asignaturaServicio: AsignaturaServicio,\n    private autenticacionServicio: AutenticacionServicio\n  ) { }\n\n  obtenerInscripcionesEstudiante(estudianteId: number): Observable<Inscripcion[]> {\n    console.log(estudianteId)\n    return this.http.get<any>(`${this.apiUrl}/estudiante/${estudianteId}`)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            console.log('Procesando inscripciones del estudiante:', respuesta.data);\n            return respuesta.data.map((item: any) => ({\n              id: item.id,\n              estudianteId: item.estudianteId,\n              asignaturaId: item.materiaId,\n              fechaInscripcion: new Date(item.fechaRegistro),\n              estudiante: item.nombreEstudiante ? {\n                id: item.estudianteId,\n                nombre: item.nombreEstudiante,\n                matricula: '',\n                email: ''\n              } : undefined,\n              asignatura: item.nombreMateria ? {\n                id: item.materiaId,\n                nombre: item.nombreMateria,\n                codigo: '',\n                creditos: 0,\n                profesorId: 0\n              } : undefined\n            }));\n          }\n          return [];\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  obtenerInscripcionesAsignatura(asignaturaId: number): Observable<Inscripcion[]> {\n    return this.http.get<any>(`${this.apiUrl}/materia/${asignaturaId}`)\n      .pipe(\n        map(respuesta => {\n          console.log('Obteniendo inscripciones para la asignatura:', asignaturaId);\n          if (respuesta && respuesta.exito && respuesta.data) {\n            console.log('Datos de inscripciones obtenidos:', respuesta.data);\n            return respuesta.data.map((item: any) => ({\n              id: item.id,\n              estudianteId: item.estudianteId,\n              asignaturaId: item.materiaId,\n              fechaInscripcion: new Date(item.fechaRegistro),\n              estudiante: item.nombreEstudiante ? {\n                id: item.estudianteId,\n                nombre: item.nombreEstudiante,\n                matricula: '',\n                email: ''\n              } : undefined,\n              asignatura: item.nombreMateria ? {\n                id: item.materiaId,\n                nombre: item.nombreMateria,\n                codigo: '',\n                creditos: item.creditos,\n                profesorId: 0\n              } : undefined\n            }));\n          }\n          return [];\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  obtenerInscripcion(id: number): Observable<Inscripcion> {\n    return this.http.get<any>(`${this.apiUrl}/${id}`)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            const item = respuesta.data;\n            return {\n              id: item.id,\n              estudianteId: item.estudianteId,\n              asignaturaId: item.materiaId,\n              fechaInscripcion: new Date(item.fechaRegistro),\n              estudiante: item.nombreEstudiante ? {\n                id: item.estudianteId,\n                nombre: item.nombreEstudiante,\n                matricula: '',\n                correo: ''\n              } : undefined,\n              asignatura: item.nombreMateria ? {\n                id: item.materiaId,\n                nombre: item.nombreMateria,\n                codigo: '',\n                creditos: 0,\n                profesorId: 0\n              } : undefined\n            };\n          }\n          throw new Error('Inscripción no encontrada');\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  inscribirAsignatura(solicitud: SolicitudInscripcion): Observable<Inscripcion> {\n    const estudianteId = solicitud.estudianteId;\n    return this.obtenerInscripcionesEstudiante(estudianteId).pipe(\n      switchMap(inscripciones => {\n        if (inscripciones.length >= this.MAX_ASIGNATURAS) {\n          return throwError(() => new Error('No puedes inscribirte en más de 3 asignaturas'));\n        }\n        const asignaturasRegistradasIds = inscripciones.map(i => i.asignaturaId);\n        if (asignaturasRegistradasIds.includes(solicitud.asignaturaId)) {\n          return throwError(() => new Error('Ya estás inscrito en esta asignatura'));\n        }\n        if (asignaturasRegistradasIds.length === 0) {\n          const solicitudBackend = {\n            estudianteId: solicitud.estudianteId,\n            nombreEstudiante: solicitud.nombreEstudiante || '',\n            materiaId: solicitud.asignaturaId,\n            nombreMateria: solicitud.nombreAsignatura || '',\n            fechaRegistro: new Date()\n          };\n          return this.http.post<any>(this.apiUrl, solicitudBackend)\n            .pipe(\n              map(respuesta => {\n                if (respuesta && respuesta.exito && respuesta.data) {\n                  const item = respuesta.data;\n                  return {\n                    id: item.id,\n                    estudianteId: item.estudianteId,\n                    asignaturaId: item.materiaId,\n                    fechaInscripcion: new Date(item.fechaRegistro),\n                    estudiante: item.nombreEstudiante ? {\n                      id: item.estudianteId,\n                      nombre: item.nombreEstudiante,\n                      matricula: '',\n                      correo: ''\n                    } : undefined,\n                    asignatura: item.nombreMateria ? {\n                      id: item.materiaId,\n                      nombre: item.nombreMateria,\n                      codigo: '',\n                      creditos: 0,\n                      profesorId: 0\n                    } : undefined\n                  };\n                }\n                throw new Error('Error al registrar la asignatura');\n              }),\n              catchError(this.manejarError)\n            );\n        }\n        return this.asignaturaServicio.obtenerAsignatura(solicitud.asignaturaId).pipe(\n          switchMap(nuevaAsignatura => {\n            return this.asignaturaServicio.obtenerAsignaturasPorIds(asignaturasRegistradasIds).pipe(\n              switchMap(asignaturasRegistradas => {\n                const profesoresIds = asignaturasRegistradas.map(a => a.profesorId);\n                if (profesoresIds.includes(nuevaAsignatura.profesorId)) {\n                  return throwError(() => new Error('No puedes tener más de una asignatura con el mismo profesor'));\n                }\n                const solicitudBackend = {\n                  estudianteId: solicitud.estudianteId,\n                  nombreEstudiante: solicitud.nombreEstudiante || '',\n                  materiaId: solicitud.asignaturaId,\n                  nombreMateria: solicitud.nombreAsignatura || '',\n                  fechaRegistro: new Date()\n                };\n                return this.http.post<any>(this.apiUrl, solicitudBackend)\n                  .pipe(\n                    map(respuesta => {\n                      if (respuesta && respuesta.exito && respuesta.data) {\n                        const item = respuesta.data;\n                        return {\n                          id: item.id,\n                          estudianteId: item.estudianteId,\n                          asignaturaId: item.materiaId,\n                          fechaInscripcion: new Date(item.fechaRegistro),\n                          estudiante: item.nombreEstudiante ? {\n                            id: item.estudianteId,\n                            nombre: item.nombreEstudiante,\n                            matricula: '',\n                            correo: ''\n                          } : undefined,\n                          asignatura: item.nombreMateria ? {\n                            id: item.materiaId,\n                            nombre: item.nombreMateria,\n                            codigo: '',\n                            creditos: 0,\n                            profesorId: 0\n                          } : undefined\n                        };\n                      }\n                      throw new Error('Error al registrar la asignatura');\n                    }),\n                    catchError(this.manejarError)\n                  );\n              })\n            );\n          })\n        );\n      })\n    );\n  }\n\n  desinscribirAsignatura(inscripcionId: number): Observable<any> {\n    return this.http.delete<any>(`${this.apiUrl}/${inscripcionId}`)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito) {\n            return respuesta.data;\n          }\n          throw new Error('Error al eliminar la inscripción');\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  obtenerCompaneros(asignaturaId: number, estudianteId: number): Observable<Estudiante[]> {\n    return this.http.get<any>(`${this.apiUrl}/materia/${asignaturaId}`)\n      .pipe(\n        map(response => {\n          if (response && response.exito && response.data) {\n            return response.data.map((item: any) => ({\n              id: item.id,\n              studentId: item.estudianteId,\n              subjectId: item.materiaId,\n              registrationDate: new Date(item.fechaRegistro),\n              student: item.nombreEstudiante ? { \n                id: item.estudianteId, \n                name: item.nombreEstudiante,\n                studentId: '',\n                email: ''\n              } : undefined,\n              subject: item.nombreMateria ? {\n                id: item.materiaId,\n                name: item.nombreMateria,\n                code: '',\n                credits: 0,\n                professorId: 0\n              } : undefined\n            }));\n          }\n          return [];\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  registrarAsignatura(solicitud: SolicitudInscripcion): Observable<Inscripcion> {\n    const estudianteId = solicitud.estudianteId;\n    return this.obtenerInscripcionesEstudiante(estudianteId).pipe(\n      switchMap(inscripciones => {\n        if (inscripciones.length >= this.MAX_ASIGNATURAS) {\n          return throwError(() => new Error('No puedes inscribirte en más de 3 asignaturas'));\n        }\n        const asignaturasRegistradasIds = inscripciones.map(i => i.asignaturaId);\n        if (asignaturasRegistradasIds.includes(solicitud.asignaturaId)) {\n          return throwError(() => new Error('Ya estás inscrito en esta asignatura'));\n        }\n        if (asignaturasRegistradasIds.length === 0) {\n          const solicitudBackend = {\n            estudianteId: solicitud.estudianteId,\n            nombreEstudiante: solicitud.nombreEstudiante || '',\n            materiaId: solicitud.asignaturaId,\n            nombreMateria: solicitud.nombreAsignatura || '',\n            fechaRegistro: new Date()\n          };\n          return this.http.post<any>(this.apiUrl, solicitudBackend)\n            .pipe(\n              map(respuesta => {\n                if (respuesta && respuesta.exito && respuesta.data) {\n                  const item = respuesta.data;\n                  return {\n                    id: item.id,\n                    estudianteId: item.estudianteId,\n                    asignaturaId: item.materiaId,\n                    fechaInscripcion: new Date(item.fechaRegistro),\n                    estudiante: item.nombreEstudiante ? {\n                      id: item.estudianteId,\n                      nombre: item.nombreEstudiante,\n                      matricula: '',\n                      correo: ''\n                    } : undefined,\n                    asignatura: item.nombreMateria ? {\n                      id: item.materiaId,\n                      nombre: item.nombreMateria,\n                      codigo: '',\n                      creditos: 0,\n                      profesorId: 0\n                    } : undefined\n                  };\n                }\n                throw new Error('Error al registrar la asignatura');\n              }),\n              catchError(this.manejarError)\n            );\n        }\n        return this.asignaturaServicio.obtenerAsignatura(solicitud.asignaturaId).pipe(\n          switchMap(nuevaAsignatura => {\n            return this.asignaturaServicio.obtenerAsignaturasPorIds(asignaturasRegistradasIds).pipe(\n              switchMap(asignaturasRegistradas => {\n                const profesoresIds = asignaturasRegistradas.map(a => a.profesorId);\n                if (profesoresIds.includes(nuevaAsignatura.profesorId)) {\n                  return throwError(() => new Error('No puedes tener más de una asignatura con el mismo profesor'));\n                }\n                const solicitudBackend = {\n                  estudianteId: solicitud.estudianteId,\n                  nombreEstudiante: solicitud.nombreEstudiante || '',\n                  materiaId: solicitud.asignaturaId,\n                  nombreMateria: solicitud.nombreAsignatura || '',\n                  fechaRegistro: new Date()\n                };\n                return this.http.post<any>(this.apiUrl, solicitudBackend)\n                  .pipe(\n                    map(respuesta => {\n                      if (respuesta && respuesta.exito && respuesta.data) {\n                        const item = respuesta.data;\n                        return {\n                          id: item.id,\n                          estudianteId: item.estudianteId,\n                          asignaturaId: item.materiaId,\n                          fechaInscripcion: new Date(item.fechaRegistro),\n                          estudiante: item.nombreEstudiante ? {\n                            id: item.estudianteId,\n                            nombre: item.nombreEstudiante,\n                            matricula: '',\n                            correo: ''\n                          } : undefined,\n                          asignatura: item.nombreMateria ? {\n                            id: item.materiaId,\n                            nombre: item.nombreMateria,\n                            codigo: '',\n                            creditos: 0,\n                            profesorId: 0\n                          } : undefined\n                        };\n                      }\n                      throw new Error('Error al registrar la asignatura');\n                    }),\n                    catchError(this.manejarError)\n                  );\n              })\n            );\n          })\n        );\n      })\n    );\n  }\n\n\n  puedeAccederSeccionEstudiante(): Observable<boolean> {\n    return this.autenticacionServicio.obtenerUsuarioActual().pipe(\n      map(user => {\n        // Solo los administradores y profesores pueden acceder a la sección de estudiantes\n        return user?.role === 'admin' || user?.role === 'professor';\n      }),\n      catchError(() => of(false))\n    );\n  }\n\n  obtenerTotalCreditosEstudiante(studentId: number): Observable<number> {\n    return this.obtenerInscripcionesEstudiante(studentId).pipe(\n      switchMap(registrations => {\n        if (registrations.length === 0) {\n          return new Observable<number>(observer => {\n            observer.next(0);\n            observer.complete();\n          });\n        }\n        \n        const subjectIds = registrations.map(r => r.asignaturaId);\n        return this.asignaturaServicio.obtenerAsignaturasPorIds(subjectIds).pipe(\n          map(subjects => {\n            return subjects.reduce((total, subject) => total + subject.creditos, 0);\n          })\n        );\n      }),\n      catchError(this.manejarError)\n    );\n  }\n  \n  private manejarError(error: any) {\n    let mensajeError = '¡Ocurrió un error desconocido!';\n    if (error.error instanceof ErrorEvent) {\n      mensajeError = `Error: ${error.error.message}`;\n    } else if (error.error && error.error.message) {\n      mensajeError = error.error.message;\n    } else if (error.status) {\n      mensajeError = `Error ${error.status}: ${error.statusText}`;\n    }\n    return throwError(() => new Error(mensajeError));\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}