{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../services/student.service\";\nimport * as i3 from \"../../services/subject.service\";\nimport * as i4 from \"../../services/registration.service\";\nimport * as i5 from \"../../services/auth.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"../classmates/classmates.component\";\nimport * as i9 from \"../student-credits/student-credits.component\";\nfunction StudentDetailComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.error, \" \");\n  }\n}\nfunction StudentDetailComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"span\", 7);\n    i0.ɵɵtext(3, \"Cargando...\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nconst _c0 = function (a1) {\n  return [\"/students\", a1, \"edit\"];\n};\nfunction StudentDetailComponent_div_3_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 27);\n    i0.ɵɵtext(1, \"Editar\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(1, _c0, ctx_r3.student.id));\n  }\n}\nfunction StudentDetailComponent_div_3_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r4.registrationError, \" \");\n  }\n}\nfunction StudentDetailComponent_div_3_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtext(1, \" No hay materias registradas. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction StudentDetailComponent_div_3_div_38_th_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\");\n    i0.ɵɵtext(1, \"Acciones\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction StudentDetailComponent_div_3_div_38_tr_14_td_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\")(1, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function StudentDetailComponent_div_3_div_38_tr_14_td_12_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const reg_r10 = i0.ɵɵnextContext().$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r12.unregisterSubject(reg_r10.id));\n    });\n    i0.ɵɵelement(2, \"i\", 36);\n    i0.ɵɵtext(3, \" Eliminar \");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction StudentDetailComponent_div_3_div_38_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\")(8, \"button\", 32);\n    i0.ɵɵtext(9, \" Ver compau00f1eros \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 33);\n    i0.ɵɵelement(11, \"app-classmates\", 34);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(12, StudentDetailComponent_div_3_div_38_tr_14_td_12_Template, 4, 0, \"td\", 3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const reg_r10 = ctx.$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reg_r10.subject == null ? null : reg_r10.subject.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reg_r10.subject == null ? null : reg_r10.subject.credits);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reg_r10.subject == null ? null : reg_r10.subject.professor == null ? null : reg_r10.subject.professor.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵattribute(\"data-bs-target\", \"#classmates-\" + reg_r10.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"id\", \"classmates-\" + reg_r10.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"subjectId\", reg_r10.subjectId)(\"currentStudentId\", ctx_r9.student.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.isCurrentUser);\n  }\n}\nfunction StudentDetailComponent_div_3_div_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 29)(1, \"table\", 30)(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Materia\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Cru00e9ditos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Profesor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Compau00f1eros\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(12, StudentDetailComponent_div_3_div_38_th_12_Template, 2, 0, \"th\", 3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"tbody\");\n    i0.ɵɵtemplate(14, StudentDetailComponent_div_3_div_38_tr_14_Template, 13, 8, \"tr\", 31);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.isCurrentUser);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r6.registrations);\n  }\n}\nfunction StudentDetailComponent_div_3_div_39_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 44);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const subject_r16 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", subject_r16.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", subject_r16.name, \" - Prof. \", subject_r16.professor == null ? null : subject_r16.professor.name, \" \");\n  }\n}\nfunction StudentDetailComponent_div_3_div_39_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 37)(1, \"h5\");\n    i0.ɵɵtext(2, \"Registrar Nueva Materia\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 38)(4, \"div\", 20)(5, \"select\", 39);\n    i0.ɵɵlistener(\"ngModelChange\", function StudentDetailComponent_div_3_div_39_Template_select_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r17.selectedSubjectId = $event);\n    });\n    i0.ɵɵelementStart(6, \"option\", 40);\n    i0.ɵɵtext(7, \"Seleccionar materia...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, StudentDetailComponent_div_3_div_39_option_8_Template, 2, 3, \"option\", 41);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\", 13)(10, \"button\", 42);\n    i0.ɵɵlistener(\"click\", function StudentDetailComponent_div_3_div_39_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r19 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r19.registerSubject());\n    });\n    i0.ɵɵelement(11, \"i\", 43);\n    i0.ɵɵtext(12, \" Registrar \");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r7.selectedSubjectId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngValue\", null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r7.availableSubjects);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", !ctx_r7.selectedSubjectId || ctx_r7.loading);\n  }\n}\nfunction StudentDetailComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 8)(2, \"h2\");\n    i0.ɵɵtext(3, \"Detalle del Estudiante\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 9)(5, \"button\", 10);\n    i0.ɵɵtext(6, \"Volver\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, StudentDetailComponent_div_3_button_7_Template, 2, 3, \"button\", 11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 12)(9, \"div\", 13)(10, \"div\", 14)(11, \"div\", 15)(12, \"h5\", 16);\n    i0.ɵɵtext(13, \"Informaciu00f3n Personal\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"div\", 17)(15, \"div\", 18)(16, \"strong\");\n    i0.ɵɵtext(17, \"Matru00edcula:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 18)(20, \"strong\");\n    i0.ɵɵtext(21, \"Nombre:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 18)(24, \"strong\");\n    i0.ɵɵtext(25, \"Correo Electru00f3nico:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(26);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(27, \"app-student-credits\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"div\", 20)(29, \"div\", 21)(30, \"div\", 22)(31, \"h5\", 16);\n    i0.ɵɵtext(32, \"Materias Registradas\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"span\", 23);\n    i0.ɵɵtext(34);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(35, \"div\", 17);\n    i0.ɵɵtemplate(36, StudentDetailComponent_div_3_div_36_Template, 2, 1, \"div\", 1);\n    i0.ɵɵtemplate(37, StudentDetailComponent_div_3_div_37_Template, 2, 0, \"div\", 24);\n    i0.ɵɵtemplate(38, StudentDetailComponent_div_3_div_38_Template, 15, 2, \"div\", 25);\n    i0.ɵɵtemplate(39, StudentDetailComponent_div_3_div_39_Template, 13, 4, \"div\", 26);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isAdmin);\n    i0.ɵɵadvance(11);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.student.studentId, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.student.name, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.student.email, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"studentId\", ctx_r2.student.id);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.registrations.length, \"/3 Materias\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.registrationError);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.registrations.length === 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.registrations.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r2.isCurrentUser || ctx_r2.isAdmin) && ctx_r2.registrations.length < 3);\n  }\n}\nexport class StudentDetailComponent {\n  constructor(route, router, studentService, subjectService, registrationService, authService) {\n    this.route = route;\n    this.router = router;\n    this.studentService = studentService;\n    this.subjectService = subjectService;\n    this.registrationService = registrationService;\n    this.authService = authService;\n    this.student = null;\n    this.registrations = [];\n    this.availableSubjects = [];\n    this.selectedSubjectId = null;\n    this.loading = false;\n    this.error = '';\n    this.registrationError = '';\n    this.isAdmin = false;\n    this.isCurrentUser = false;\n  }\n  ngOnInit() {\n    this.isAdmin = this.authService.isAdmin();\n    this.route.params.subscribe(params => {\n      const id = +params['id'];\n      this.loadStudent(id);\n      this.loadRegistrations(id);\n      // Check if current user is viewing their own profile\n      const currentUserId = this.authService.getCurrentUserId();\n      this.isCurrentUser = currentUserId === id;\n    });\n    this.loadSubjects();\n  }\n  loadStudent(id) {\n    this.loading = true;\n    this.studentService.getStudent(id).subscribe({\n      next: data => {\n        this.student = data;\n        this.loading = false;\n      },\n      error: err => {\n        this.error = 'Error al cargar datos del estudiante';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n  loadRegistrations(studentId) {\n    this.loading = true;\n    this.studentService.getStudentRegistrations(studentId).subscribe({\n      next: data => {\n        this.registrations = data;\n        this.loading = false;\n        this.updateAvailableSubjects();\n      },\n      error: err => {\n        this.error = 'Error al cargar registros del estudiante';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n  loadSubjects() {\n    this.subjectService.getSubjects().subscribe({\n      next: data => {\n        this.availableSubjects = data;\n        this.updateAvailableSubjects();\n      },\n      error: err => {\n        console.error('Error al cargar materias', err);\n      }\n    });\n  }\n  updateAvailableSubjects() {\n    if (this.registrations.length > 0 && this.availableSubjects.length > 0) {\n      // Filtrar materias ya registradas\n      const registeredSubjectIds = this.registrations.map(r => r.subjectId);\n      // Filtrar materias con profesores que ya tienen clases con el estudiante\n      const registeredProfessorIds = this.registrations.map(r => this.availableSubjects.find(s => s.id === r.subjectId)?.professorId).filter(id => id !== undefined);\n      this.availableSubjects = this.availableSubjects.filter(subject => !registeredSubjectIds.includes(subject.id) && !registeredProfessorIds.includes(subject.professorId));\n    }\n  }\n  registerSubject() {\n    if (!this.student || !this.selectedSubjectId) {\n      this.registrationError = 'Debe seleccionar una materia';\n      return;\n    }\n    if (this.registrations.length >= 3) {\n      this.registrationError = 'Ya ha registrado el máximo de 3 materias permitidas';\n      return;\n    }\n    this.loading = true;\n    this.registrationError = '';\n    this.registrationService.registerSubject({\n      studentId: this.student.id,\n      subjectId: this.selectedSubjectId\n    }).subscribe({\n      next: () => {\n        this.loading = false;\n        this.loadRegistrations(this.student.id);\n        this.selectedSubjectId = null;\n      },\n      error: err => {\n        this.registrationError = err.message || 'Error al registrar materia';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n  unregisterSubject(registrationId) {\n    if (confirm('¿Está seguro de eliminar este registro?')) {\n      this.loading = true;\n      this.registrationService.unregisterSubject(registrationId).subscribe({\n        next: () => {\n          this.loading = false;\n          this.loadRegistrations(this.student.id);\n        },\n        error: err => {\n          this.error = 'Error al eliminar registro';\n          this.loading = false;\n          console.error(err);\n        }\n      });\n    }\n  }\n  static {\n    this.ɵfac = function StudentDetailComponent_Factory(t) {\n      return new (t || StudentDetailComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.StudentService), i0.ɵɵdirectiveInject(i3.SubjectService), i0.ɵɵdirectiveInject(i4.RegistrationService), i0.ɵɵdirectiveInject(i5.AuthService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: StudentDetailComponent,\n      selectors: [[\"app-student-detail\"]],\n      decls: 4,\n      vars: 3,\n      consts: [[1, \"container\", \"mt-4\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [\"class\", \"d-flex justify-content-center\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"alert\", \"alert-danger\"], [1, \"d-flex\", \"justify-content-center\"], [\"role\", \"status\", 1, \"spinner-border\"], [1, \"visually-hidden\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-4\"], [1, \"btn-group\"], [\"routerLink\", \"/students\", 1, \"btn\", \"btn-outline-secondary\"], [\"class\", \"btn btn-outline-primary\", 3, \"routerLink\", 4, \"ngIf\"], [1, \"row\"], [1, \"col-md-4\"], [1, \"card\", \"mb-4\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"mb-0\"], [1, \"card-body\"], [1, \"mb-3\"], [3, \"studentId\"], [1, \"col-md-8\"], [1, \"card\"], [1, \"card-header\", \"bg-primary\", \"text-white\", \"d-flex\", \"justify-content-between\", \"align-items-center\"], [1, \"badge\", \"bg-light\", \"text-dark\"], [\"class\", \"alert alert-info\", 4, \"ngIf\"], [\"class\", \"table-responsive\", 4, \"ngIf\"], [\"class\", \"mt-4\", 4, \"ngIf\"], [1, \"btn\", \"btn-outline-primary\", 3, \"routerLink\"], [1, \"alert\", \"alert-info\"], [1, \"table-responsive\"], [1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", \"data-bs-toggle\", \"collapse\", 1, \"btn\", \"btn-sm\", \"btn-outline-info\"], [1, \"collapse\", \"mt-2\", 3, \"id\"], [3, \"subjectId\", \"currentStudentId\"], [1, \"btn\", \"btn-sm\", \"btn-outline-danger\", 3, \"click\"], [1, \"bi\", \"bi-trash\"], [1, \"mt-4\"], [1, \"row\", \"g-3\", \"align-items-center\"], [1, \"form-select\", 3, \"ngModel\", \"ngModelChange\"], [3, \"ngValue\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"btn\", \"btn-primary\", 3, \"disabled\", \"click\"], [1, \"bi\", \"bi-plus-circle\"], [3, \"value\"]],\n      template: function StudentDetailComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0);\n          i0.ɵɵtemplate(1, StudentDetailComponent_div_1_Template, 2, 1, \"div\", 1);\n          i0.ɵɵtemplate(2, StudentDetailComponent_div_2_Template, 4, 0, \"div\", 2);\n          i0.ɵɵtemplate(3, StudentDetailComponent_div_3_Template, 40, 10, \"div\", 3);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.error);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.student && !ctx.loading);\n        }\n      },\n      dependencies: [i6.NgForOf, i6.NgIf, i1.RouterLink, i7.NgSelectOption, i7.ɵNgSelectMultipleOption, i7.SelectControlValueAccessor, i7.NgControlStatus, i7.NgModel, i8.ClassmatesComponent, i9.StudentCreditsComponent],\n      styles: [\".card[_ngcontent-%COMP%] {\\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\\n  margin-bottom: 20px;\\n}\\n\\n.card-header[_ngcontent-%COMP%] {\\n  font-weight: 500;\\n}\\n\\n.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\\n  font-weight: 600;\\n  background-color: #f8f9fa;\\n}\\n\\n.badge[_ngcontent-%COMP%] {\\n  font-size: 85%;\\n  padding: 5px 10px;\\n}\\n\\nstrong[_ngcontent-%COMP%] {\\n  font-weight: 600;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9zdHVkZW50LWRldGFpbC9zdHVkZW50LWRldGFpbC5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG9DQUFvQztBQUNwQztFQUNFLHdDQUF3QztFQUN4QyxtQkFBbUI7QUFDckI7O0FBRUE7RUFDRSxnQkFBZ0I7QUFDbEI7O0FBRUE7RUFDRSxnQkFBZ0I7RUFDaEIseUJBQXlCO0FBQzNCOztBQUVBO0VBQ0UsY0FBYztFQUNkLGlCQUFpQjtBQUNuQjs7QUFFQTtFQUNFLGdCQUFnQjtBQUNsQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIFN0dWRlbnQgRGV0YWlsIENvbXBvbmVudCBTdHlsZXMgKi9cbi5jYXJkIHtcbiAgYm94LXNoYWRvdzogMCA0cHggOHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgbWFyZ2luLWJvdHRvbTogMjBweDtcbn1cblxuLmNhcmQtaGVhZGVyIHtcbiAgZm9udC13ZWlnaHQ6IDUwMDtcbn1cblxuLnRhYmxlIHRoIHtcbiAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2Y4ZjlmYTtcbn1cblxuLmJhZGdlIHtcbiAgZm9udC1zaXplOiA4NSU7XG4gIHBhZGRpbmc6IDVweCAxMHB4O1xufVxuXG5zdHJvbmcge1xuICBmb250LXdlaWdodDogNjAwO1xufSJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["i0","StudentDetailComponent","constructor","route","router","studentService","subjectService","registrationService","authService","ngOnInit","isAdmin","params","subscribe","id","loadStudent","loadRegistrations","currentUserId","getCurrentUserId","isCurrentUser","loadSubjects","loading","getStudent","next","data","student","error","err","console","studentId","getStudentRegistrations","registrations","updateAvailableSubjects","getSubjects","availableSubjects","length","registeredSubjectIds","map","r","subjectId","registeredProfessorIds","find","s","professorId","filter","undefined","subject","includes","registerSubject","selectedSubjectId","registrationError","message","unregisterSubject","registrationId","confirm","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\hansk\\Videos\\Prueba interrapidisimp\\frontend\\src\\app\\components\\student-detail\\student-detail.component.html","C:\\Users\\hansk\\Videos\\Prueba interrapidisimp\\frontend\\src\\app\\components\\student-detail\\student-detail.component.ts"],"sourcesContent":["<div class=\"container mt-4\">\n  <div *ngIf=\"error\" class=\"alert alert-danger\">\n    {{ error }}\n  </div>\n  \n  <div *ngIf=\"loading\" class=\"d-flex justify-content-center\">\n    <div class=\"spinner-border\" role=\"status\">\n      <span class=\"visually-hidden\">Cargando...</span>\n    </div>\n  </div>\n  \n  <div *ngIf=\"student && !loading\">\n    <div class=\"d-flex justify-content-between align-items-center mb-4\">\n      <h2>Detalle del Estudiante</h2>\n      <div class=\"btn-group\">\n        <button class=\"btn btn-outline-secondary\" routerLink=\"/students\">Volver</button>\n        <button class=\"btn btn-outline-primary\" [routerLink]=\"['/students', student.id, 'edit']\" *ngIf=\"isAdmin\">Editar</button>\n      </div>\n    </div>\n    \n    <div class=\"row\">\n      <div class=\"col-md-4\">\n        <div class=\"card mb-4\">\n          <div class=\"card-header bg-primary text-white\">\n            <h5 class=\"mb-0\">Informaciu00f3n Personal</h5>\n          </div>\n          <div class=\"card-body\">\n            <div class=\"mb-3\">\n              <strong>Matru00edcula:</strong> {{ student.studentId }}\n            </div>\n            <div class=\"mb-3\">\n              <strong>Nombre:</strong> {{ student.name }}\n            </div>\n            <div class=\"mb-3\">\n              <strong>Correo Electru00f3nico:</strong> {{ student.email }}\n            </div>\n          </div>\n        </div>\n        \n        <!-- Componente de créditos -->\n        <app-student-credits [studentId]=\"student.id!\"></app-student-credits>\n      </div>\n      \n      <div class=\"col-md-8\">\n        <div class=\"card\">\n          <div class=\"card-header bg-primary text-white d-flex justify-content-between align-items-center\">\n            <h5 class=\"mb-0\">Materias Registradas</h5>\n            <span class=\"badge bg-light text-dark\">{{ registrations.length }}/3 Materias</span>\n          </div>\n          <div class=\"card-body\">\n            <div *ngIf=\"registrationError\" class=\"alert alert-danger\">\n              {{ registrationError }}\n            </div>\n            \n            <div *ngIf=\"registrations.length === 0\" class=\"alert alert-info\">\n              No hay materias registradas.\n            </div>\n            \n            <div class=\"table-responsive\" *ngIf=\"registrations.length > 0\">\n              <table class=\"table table-striped\">\n                <thead>\n                  <tr>\n                    <th>Materia</th>\n                    <th>Cru00e9ditos</th>\n                    <th>Profesor</th>\n                    <th>Compau00f1eros</th>\n                    <th *ngIf=\"isCurrentUser\">Acciones</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr *ngFor=\"let reg of registrations\">\n                    <td>{{ reg.subject?.name }}</td>\n                    <td>{{ reg.subject?.credits }}</td>\n                    <td>{{ reg.subject?.professor?.name }}</td>\n                    <td>\n                      <button class=\"btn btn-sm btn-outline-info\" type=\"button\" data-bs-toggle=\"collapse\" [attr.data-bs-target]=\"'#classmates-' + reg.id\">\n                        Ver compau00f1eros\n                      </button>\n                      <div class=\"collapse mt-2\" [id]=\"'classmates-' + reg.id\">\n                        <app-classmates [subjectId]=\"reg.subjectId\" [currentStudentId]=\"student.id!\"></app-classmates>\n                      </div>\n                    </td>\n                    <td *ngIf=\"isCurrentUser\">\n                      <button class=\"btn btn-sm btn-outline-danger\" (click)=\"unregisterSubject(reg.id!)\">\n                        <i class=\"bi bi-trash\"></i> Eliminar\n                      </button>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n            \n            <div *ngIf=\"(isCurrentUser || isAdmin) && registrations.length < 3\" class=\"mt-4\">\n              <h5>Registrar Nueva Materia</h5>\n              <div class=\"row g-3 align-items-center\">\n                <div class=\"col-md-8\">\n                  <select class=\"form-select\" [(ngModel)]=\"selectedSubjectId\">\n                    <option [ngValue]=\"null\">Seleccionar materia...</option>\n                    <option *ngFor=\"let subject of availableSubjects\" [value]=\"subject.id\">\n                      {{ subject.name }} - Prof. {{ subject.professor?.name }}\n                    </option>\n                  </select>\n                </div>\n                <div class=\"col-md-4\">\n                  <button \n                    class=\"btn btn-primary\" \n                    (click)=\"registerSubject()\" \n                    [disabled]=\"!selectedSubjectId || loading\"\n                  >\n                    <i class=\"bi bi-plus-circle\"></i> Registrar\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { Student } from '../../models/student.model';\nimport { Registration } from '../../models/registration.model';\nimport { Subject } from '../../models/subject.model';\nimport { StudentService } from '../../services/student.service';\nimport { SubjectService } from '../../services/subject.service';\nimport { RegistrationService } from '../../services/registration.service';\nimport { AuthService } from '../../services/auth.service';\n\n@Component({\n  selector: 'app-student-detail',\n  templateUrl: './student-detail.component.html',\n  styleUrls: ['./student-detail.component.css']\n})\nexport class StudentDetailComponent implements OnInit {\n  student: Student | null = null;\n  registrations: Registration[] = [];\n  availableSubjects: Subject[] = [];\n  selectedSubjectId: number | null = null;\n  loading = false;\n  error = '';\n  registrationError = '';\n  isAdmin = false;\n  isCurrentUser = false;\n\n  constructor(\n    private route: ActivatedRoute,\n    private router: Router,\n    private studentService: StudentService,\n    private subjectService: SubjectService,\n    private registrationService: RegistrationService,\n    private authService: AuthService\n  ) { }\n\n  ngOnInit(): void {\n    this.isAdmin = this.authService.isAdmin();\n    \n    this.route.params.subscribe(params => {\n      const id = +params['id'];\n      this.loadStudent(id);\n      this.loadRegistrations(id);\n      \n      // Check if current user is viewing their own profile\n      const currentUserId = this.authService.getCurrentUserId();\n      this.isCurrentUser = currentUserId === id;\n    });\n    this.loadSubjects();\n  }\n\n  loadStudent(id: number): void {\n    this.loading = true;\n    this.studentService.getStudent(id).subscribe({\n      next: (data) => {\n        this.student = data;\n        this.loading = false;\n      },\n      error: (err) => {\n        this.error = 'Error al cargar datos del estudiante';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n\n  loadRegistrations(studentId: number): void {\n    this.loading = true;\n    this.studentService.getStudentRegistrations(studentId).subscribe({\n      next: (data) => {\n        this.registrations = data;\n        this.loading = false;\n        this.updateAvailableSubjects();\n      },\n      error: (err) => {\n        this.error = 'Error al cargar registros del estudiante';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n\n  loadSubjects(): void {\n    this.subjectService.getSubjects().subscribe({\n      next: (data) => {\n        this.availableSubjects = data;\n        this.updateAvailableSubjects();\n      },\n      error: (err) => {\n        console.error('Error al cargar materias', err);\n      }\n    });\n  }\n\n  updateAvailableSubjects(): void {\n    if (this.registrations.length > 0 && this.availableSubjects.length > 0) {\n      // Filtrar materias ya registradas\n      const registeredSubjectIds = this.registrations.map(r => r.subjectId);\n      \n      // Filtrar materias con profesores que ya tienen clases con el estudiante\n      const registeredProfessorIds = this.registrations\n        .map(r => this.availableSubjects.find(s => s.id === r.subjectId)?.professorId)\n        .filter(id => id !== undefined) as number[];\n      \n      this.availableSubjects = this.availableSubjects.filter(subject => \n        !registeredSubjectIds.includes(subject.id) && \n        !registeredProfessorIds.includes(subject.professorId)\n      );\n    }\n  }\n\n  registerSubject(): void {\n    if (!this.student || !this.selectedSubjectId) {\n      this.registrationError = 'Debe seleccionar una materia';\n      return;\n    }\n\n    if (this.registrations.length >= 3) {\n      this.registrationError = 'Ya ha registrado el máximo de 3 materias permitidas';\n      return;\n    }\n\n    this.loading = true;\n    this.registrationError = '';\n\n    this.registrationService.registerSubject({\n      studentId: this.student.id!,\n      subjectId: this.selectedSubjectId\n    }).subscribe({\n      next: () => {\n        this.loading = false;\n        this.loadRegistrations(this.student!.id!);\n        this.selectedSubjectId = null;\n      },\n      error: (err) => {\n        this.registrationError = err.message || 'Error al registrar materia';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n\n  unregisterSubject(registrationId: number): void {\n    if (confirm('¿Está seguro de eliminar este registro?')) {\n      this.loading = true;\n      this.registrationService.unregisterSubject(registrationId).subscribe({\n        next: () => {\n          this.loading = false;\n          this.loadRegistrations(this.student!.id!);\n        },\n        error: (err) => {\n          this.error = 'Error al eliminar registro';\n          this.loading = false;\n          console.error(err);\n        }\n      });\n    }\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}