{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/hansk/Videos/frontendsistemacolegio.interrapidisi/frontendsistemacolegio.interrapidisi/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Validators } from '@angular/forms';\nimport { firstValueFrom } from 'rxjs';\nimport { CreditosEstudianteComponente } from '../creditos-estudiante/creditos-estudiante.componente';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../../servicios/asignatura.servicio\";\nimport * as i3 from \"../../../servicios/inscripcion.servicio\";\nimport * as i4 from \"../../../servicios/autenticacion.servicio\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../compartidos/companeros/companeros.componente\";\nimport * as i8 from \"../creditos-estudiante/creditos-estudiante.componente\";\nfunction RegistroMateriasComponente_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 36)(2, \"div\", 37)(3, \"span\", 38);\n    i0.ɵɵtext(4, \"Cargando...\");\n    i0.ɵɵelementEnd()()()();\n  }\n}\nfunction RegistroMateriasComponente_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 39);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.error, \" \");\n  }\n}\nfunction RegistroMateriasComponente_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 40);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.exito, \" \");\n  }\n}\nfunction RegistroMateriasComponente_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 41)(1, \"p\");\n    i0.ɵɵtext(2, \"No tienes materias registradas.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RegistroMateriasComponente_div_18_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\")(8, \"button\", 45);\n    i0.ɵɵlistener(\"click\", function RegistroMateriasComponente_div_18_tr_13_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const inscripcion_r11 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.abrirModalCompaneros(inscripcion_r11.materiaId));\n    });\n    i0.ɵɵelement(9, \"i\", 46);\n    i0.ɵɵtext(10, \" Ver Compa\\u00F1eros \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"button\", 47);\n    i0.ɵɵlistener(\"click\", function RegistroMateriasComponente_div_18_tr_13_Template_button_click_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const inscripcion_r11 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r14.desinscribirAsignatura(inscripcion_r11.id));\n    });\n    i0.ɵɵelement(12, \"i\", 48);\n    i0.ɵɵtext(13, \" Eliminar \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const inscripcion_r11 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inscripcion_r11.nombreMateria);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inscripcion_r11.nombreProfesor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inscripcion_r11.creditos);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"btnVerCompaneros-\", inscripcion_r11.materiaId, \"\");\n  }\n}\nfunction RegistroMateriasComponente_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"table\", 43)(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Materia\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Profesor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Cr\\u00E9ditos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Acciones\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, RegistroMateriasComponente_div_18_tr_13_Template, 14, 4, \"tr\", 44);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.inscripcionesActuales);\n  }\n}\nfunction RegistroMateriasComponente_option_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 49);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const asignatura_r15 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", asignatura_r15.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\" \", asignatura_r15.nombre, \" - Prof. \", asignatura_r15.profesor == null ? null : asignatura_r15.profesor.nombre, \" (\", asignatura_r15.creditos, \" cr\\u00E9ditos) \");\n  }\n}\nfunction RegistroMateriasComponente_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 50);\n    i0.ɵɵtext(1, \" Debes seleccionar una materia. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RegistroMateriasComponente_div_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 51);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Has alcanzado el l\\u00EDmite m\\u00E1ximo de \", ctx_r7.maxAsignaturas, \" materias. \");\n  }\n}\nfunction RegistroMateriasComponente_div_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 52);\n    i0.ɵɵtext(1, \" No se ha seleccionado ninguna materia. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RegistroMateriasComponente_app_companeros_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-companeros\", 53);\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"asignaturaId\", ctx_r9.asignaturaSeleccionadaId)(\"estudianteActualId\", ctx_r9.estudianteId);\n  }\n}\nexport class RegistroMateriasComponente {\n  constructor(formBuilder, asignaturaServicio, inscripcionServicio, autenticacionServicio, router) {\n    this.formBuilder = formBuilder;\n    this.asignaturaServicio = asignaturaServicio;\n    this.inscripcionServicio = inscripcionServicio;\n    this.autenticacionServicio = autenticacionServicio;\n    this.router = router;\n    this.asignaturasDisponibles = [];\n    this.inscripcionesActuales = [];\n    this.asignaturas = []; // Para el cálculo de créditos\n    this.cargando = false;\n    this.error = '';\n    this.exito = '';\n    this.estudianteId = 0;\n    this.maxAsignaturas = 3;\n    this.asignaturaSeleccionadaId = null; // Para el modal de compañeros\n  }\n\n  ngOnInit() {\n    this.iniciarFormulario();\n    this.obtenerIdEstudianteActual();\n  }\n  iniciarFormulario() {\n    this.formularioInscripcion = this.formBuilder.group({\n      asignaturaId: [null, [Validators.required]]\n    });\n    // Agregar un listener para depurar cambios en el valor del formulario\n    this.formularioInscripcion.get('asignaturaId')?.valueChanges.subscribe(value => {\n      console.log('Valor de asignaturaId cambiado a:', value, 'tipo:', typeof value);\n    });\n  }\n  obtenerIdEstudianteActual() {\n    this.cargando = true;\n    const usuario = this.autenticacionServicio.obtenerValorUsuarioActual();\n    console.log('Usuario autenticado:', usuario);\n    if (!usuario) {\n      this.error = 'No se pudo obtener la información del usuario. Por favor, inicie sesión nuevamente.';\n      this.cargando = false;\n      return;\n    }\n    console.log('ID de estudiante:', usuario.studentId);\n    if (usuario.role !== 'student') {\n      this.error = 'Esta página es solo para estudiantes.';\n      this.cargando = false;\n      return;\n    }\n    if (!usuario.studentId) {\n      // Si el usuario es estudiante pero no tiene studentId, intentamos obtenerlo del perfil\n      this.autenticacionServicio.obtenerPerfilUsuario(usuario.id).subscribe({\n        next: perfil => {\n          console.log('Perfil obtenido:', perfil);\n          if (perfil.studentId) {\n            this.estudianteId = perfil.studentId;\n            this.cargarInscripcionesActuales();\n            this.cargarAsignaturasDisponibles();\n          } else {\n            this.error = 'No se pudo identificar al estudiante. Por favor, contacte al administrador.';\n            this.cargando = false;\n          }\n        },\n        error: err => {\n          console.error('Error al obtener perfil:', err);\n          this.error = 'Error al obtener información del estudiante: ' + err.message;\n          this.cargando = false;\n        }\n      });\n    } else {\n      this.estudianteId = usuario.studentId;\n      this.cargarInscripcionesActuales();\n      this.cargarAsignaturasDisponibles();\n    }\n  }\n  cargarInscripcionesActuales() {\n    this.inscripcionServicio.obtenerInscripcionesEstudiante(this.estudianteId).subscribe({\n      next: inscripciones => {\n        this.inscripcionesActuales = inscripciones;\n        console.log('Inscripciones actuales cargadas:', this.inscripcionesActuales);\n        // Cargar las asignaturas del estudiante para el cu00e1lculo de cru00e9ditos\n        this.asignaturaServicio.obtenerAsignaturasEstudiante(this.estudianteId).subscribe({\n          next: asignaturas => {\n            this.asignaturas = asignaturas;\n            console.log('Asignaturas del estudiante cargadas:', this.asignaturas);\n            this.cargando = false;\n          },\n          error: err => {\n            this.error = 'Error al cargar asignaturas del estudiante';\n            this.cargando = false;\n            console.error(err);\n          }\n        });\n      },\n      error: err => {\n        this.error = 'Error al cargar inscripciones actuales';\n        this.cargando = false;\n        console.error(err);\n      }\n    });\n  }\n  cargarAsignaturasDisponibles() {\n    this.asignaturaServicio.obtenerAsignaturas().subscribe({\n      next: asignaturas => {\n        // Filtrar materias ya registradas\n        const idsAsignaturasRegistradas = this.inscripcionesActuales.map(reg => reg.materiaId);\n        this.asignaturasDisponibles = asignaturas.filter(asignatura => !idsAsignaturasRegistradas.includes(asignatura.id));\n        console.log('Asignaturas disponibles:', this.asignaturasDisponibles);\n        this.cargando = false;\n      },\n      error: err => {\n        this.error = 'Error al cargar asignaturas disponibles';\n        this.cargando = false;\n        console.error(err);\n      }\n    });\n  }\n  onSubmit() {\n    if (this.formularioInscripcion.invalid) {\n      return;\n    }\n    this.cargando = true;\n    this.error = '';\n    this.exito = '';\n    // Obtener y convertir el ID de la asignatura a número para asegurar la comparación correcta\n    const asignaturaIdRaw = this.formularioInscripcion.value.asignaturaId;\n    const asignaturaId = typeof asignaturaIdRaw === 'string' ? parseInt(asignaturaIdRaw, 10) : asignaturaIdRaw;\n    console.log('Procesando inscripción de asignatura:', asignaturaId, 'tipo:', typeof asignaturaId);\n    console.log('Formulario completo:', this.formularioInscripcion.value);\n    console.log('Asignaturas disponibles:', this.asignaturasDisponibles);\n    // Verificar si ya tiene el máximo de materias\n    if (this.inscripcionesActuales.length >= this.maxAsignaturas) {\n      this.error = `No puedes registrar más de ${this.maxAsignaturas} materias`;\n      this.cargando = false;\n      return;\n    }\n    // Obtener la asignatura seleccionada para verificar sus créditos\n    console.log('Buscando asignatura con ID:', asignaturaId);\n    // Imprimir todas las asignaturas disponibles para depuración\n    this.asignaturasDisponibles.forEach(a => {\n      console.log(`Asignatura disponible - ID: ${a.id} (${typeof a.id}), Nombre: ${a.nombre}`);\n    });\n    const asignaturaSeleccionada = this.asignaturasDisponibles.find(a => a.id === asignaturaId);\n    console.log('Asignatura seleccionada:', asignaturaSeleccionada);\n    if (!asignaturaSeleccionada) {\n      this.error = 'No se pudo encontrar la información de la materia seleccionada';\n      this.cargando = false;\n      return;\n    }\n    // Calcular el total de créditos actuales\n    const creditosActuales = this.asignaturas.reduce((total, asignatura) => total + asignatura.creditos, 0);\n    const nuevoTotalCreditos = creditosActuales + asignaturaSeleccionada.creditos;\n    console.log('Créditos actuales:', creditosActuales, 'Nuevos créditos totales:', nuevoTotalCreditos);\n    // Verificar si supera el límite de 9 créditos\n    if (nuevoTotalCreditos > 9) {\n      this.error = `No puedes registrar esta materia porque superarías el límite de 9 créditos. Actualmente tienes ${creditosActuales} créditos y esta materia tiene ${asignaturaSeleccionada.creditos} créditos.`;\n      this.cargando = false;\n      return;\n    }\n    // Verificar si ya tiene una materia con el mismo profesor\n    this.verificarConflictoProfesor(asignaturaId).then(tieneConflicto => {\n      if (tieneConflicto) {\n        this.error = 'No puedes tener más de una materia con el mismo profesor';\n        this.cargando = false;\n        return;\n      }\n      // Proceder con el registro\n      const solicitudInscripcion = {\n        estudianteId: this.estudianteId,\n        materiaId: asignaturaId,\n        nombreEstudiante: this.autenticacionServicio.obtenerValorUsuarioActual()?.name || '',\n        nombreMateria: asignaturaSeleccionada?.nombre || ''\n      };\n      this.inscripcionServicio.inscribirAsignatura(solicitudInscripcion).subscribe({\n        next: inscripcion => {\n          this.exito = 'Materia registrada correctamente';\n          this.cargando = false;\n          this.formularioInscripcion.reset();\n          // Recargar los datos\n          this.cargarInscripcionesActuales();\n          this.cargarAsignaturasDisponibles();\n          // Actualizar el componente de cru00e9ditos\n          setTimeout(() => {\n            if (this.componenteCreditos) {\n              console.log('Actualizando componente de cru00e9ditos despuu00e9s de registrar materia');\n              this.componenteCreditos.actualizarCreditos();\n            } else {\n              console.warn('No se pudo acceder al componente de cru00e9ditos');\n            }\n          }, 500); // Pequeu00f1o retraso para asegurar que el componente estu00e9 disponible\n        },\n\n        error: err => {\n          this.error = err.message || 'Error al registrar la materia';\n          this.cargando = false;\n          console.error(err);\n        }\n      });\n    }).catch(err => {\n      this.error = 'Error al verificar conflictos de profesor';\n      this.cargando = false;\n      console.error(err);\n    });\n  }\n  verificarConflictoProfesor(nuevaAsignaturaId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      console.log('Verificando conflicto de profesor para asignatura ID:', nuevaAsignaturaId, 'tipo:', typeof nuevaAsignaturaId);\n      // Si no hay registros actuales, no hay conflicto\n      if (_this.inscripcionesActuales.length === 0) {\n        return false;\n      }\n      try {\n        // Obtener la nueva materia\n        const nuevaAsignatura = yield firstValueFrom(_this.asignaturaServicio.obtenerAsignatura(nuevaAsignaturaId));\n        console.log('Nueva asignatura obtenida:', nuevaAsignatura);\n        if (!nuevaAsignatura) return false;\n        // Obtener las materias actuales\n        const idsAsignaturasActuales = _this.inscripcionesActuales.map(reg => reg.materiaId);\n        console.log('IDs de asignaturas actuales:', idsAsignaturasActuales);\n        const asignaturasActuales = yield firstValueFrom(_this.asignaturaServicio.obtenerAsignaturasPorIds(idsAsignaturasActuales));\n        console.log('Asignaturas actuales obtenidas:', asignaturasActuales);\n        if (!asignaturasActuales) return false;\n        // Verificar si hay conflicto de profesor\n        const tieneConflicto = asignaturasActuales.some(asignatura => asignatura.profesorId === nuevaAsignatura.profesorId);\n        console.log('¿Tiene conflicto de profesor?', tieneConflicto);\n        return tieneConflicto;\n      } catch (error) {\n        console.error('Error al verificar conflicto de profesor:', error);\n        return false;\n      }\n    })();\n  }\n  desinscribirAsignatura(inscripcionId) {\n    if (!inscripcionId) {\n      this.error = 'ID de inscripción no válido';\n      return;\n    }\n    if (confirm('¿Estás seguro de que deseas eliminar esta materia?')) {\n      this.cargando = true;\n      this.error = '';\n      this.exito = '';\n      this.inscripcionServicio.desinscribirAsignatura(inscripcionId).subscribe({\n        next: () => {\n          this.exito = 'Materia eliminada correctamente';\n          this.cargando = false;\n          // Recargar los datos\n          this.cargarInscripcionesActuales();\n          this.cargarAsignaturasDisponibles();\n        },\n        error: err => {\n          // Actualizar el componente de créditos\n          setTimeout(() => {\n            if (this.componenteCreditos) {\n              console.log('Actualizando componente de créditos después de eliminar materia');\n              this.componenteCreditos.actualizarCreditos();\n            } else {\n              console.warn('No se pudo acceder al componente de créditos');\n            }\n          }, 500); // Pequeño retraso para asegurar que el componente esté disponible          this.error = 'Error al eliminar la materia';\n          this.cargando = false;\n          console.error(err);\n        }\n      });\n    }\n  }\n  // Método para abrir el modal de compañeros\n  abrirModalCompaneros(asignaturaId) {\n    if (!asignaturaId) {\n      this.error = 'Error: No se pudo identificar la materia seleccionada';\n      setTimeout(() => this.error = '', 3000); // Limpiar el mensaje después de 3 segundos\n      return;\n    }\n    this.asignaturaSeleccionadaId = asignaturaId;\n    try {\n      // Asegurarse de que Bootstrap esté disponible\n      if (typeof bootstrap === 'undefined') {\n        console.error('Bootstrap no está disponible');\n        this.error = 'Error al mostrar la ventana modal. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n        return;\n      }\n      // Usar Bootstrap 5 para abrir el modal\n      const elementoModal = document.getElementById('modalCompaneros');\n      if (elementoModal) {\n        // Asegurarse de que cualquier modal previo se cierre\n        const modalExistente = bootstrap.Modal.getInstance(elementoModal);\n        if (modalExistente) {\n          modalExistente.dispose();\n        }\n        // Crear una nueva instancia del modal con opciones específicas\n        const opcionesModal = {\n          backdrop: 'static',\n          keyboard: true,\n          focus: true // Enfoca el modal cuando se abre\n        };\n\n        const instanciaModal = new bootstrap.Modal(elementoModal, opcionesModal);\n        // Asegurarse de que el modal esté visible\n        elementoModal.style.display = 'block';\n        elementoModal.style.zIndex = '1050';\n        instanciaModal.show();\n        // Verificar que el modal se haya abierto correctamente\n        setTimeout(() => {\n          if (elementoModal.classList.contains('show')) {\n            console.log('Modal mostrado correctamente');\n          } else {\n            console.error('El modal no se mostró correctamente');\n            this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n            setTimeout(() => this.error = '', 3000);\n          }\n        }, 500);\n      } else {\n        console.error('No se encontró el elemento del modal con ID: classmatesModal');\n        this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n      }\n    } catch (e) {\n      console.error('Error al abrir el modal:', e);\n      this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n      setTimeout(() => this.error = '', 3000);\n    }\n  }\n  static {\n    this.ɵfac = function RegistroMateriasComponente_Factory(t) {\n      return new (t || RegistroMateriasComponente)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.AsignaturaServicio), i0.ɵɵdirectiveInject(i3.InscripcionServicio), i0.ɵɵdirectiveInject(i4.AutenticacionServicio), i0.ɵɵdirectiveInject(i5.Router));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: RegistroMateriasComponente,\n      selectors: [[\"app-registro-materias\"]],\n      viewQuery: function RegistroMateriasComponente_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(CreditosEstudianteComponente, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.componenteCreditos = _t.first);\n        }\n      },\n      decls: 55,\n      vars: 15,\n      consts: [[1, \"container\", \"mt-4\"], [1, \"row\"], [1, \"col-md-12\"], [\"class\", \"row\", 4, \"ngIf\"], [1, \"row\", \"mb-4\"], [1, \"card\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"card-body\"], [3, \"estudianteId\"], [\"class\", \"text-center mt-3\", 4, \"ngIf\"], [\"class\", \"table-responsive\", 4, \"ngIf\"], [1, \"card-header\", \"bg-success\", \"text-white\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"mb-3\"], [\"for\", \"asignaturaId\", 1, \"form-label\"], [\"id\", \"asignaturaId\", \"formControlName\", \"asignaturaId\", 1, \"form-select\"], [\"value\", \"\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"invalid-feedback\", 4, \"ngIf\"], [1, \"d-grid\", \"gap-2\"], [\"type\", \"submit\", 1, \"btn\", \"btn-success\", 3, \"disabled\"], [1, \"bi\", \"bi-plus-circle\"], [\"class\", \"alert alert-warning mt-3\", 4, \"ngIf\"], [\"id\", \"modalCompaneros\", \"tabindex\", \"-1\", \"aria-labelledby\", \"modalCompanerosLabel\", \"aria-hidden\", \"true\", \"data-testid\", \"classmates-modal\", 1, \"modal\", \"fade\"], [1, \"modal-dialog\", \"modal-dialog-centered\", \"modal-lg\"], [1, \"modal-content\", \"shadow\"], [1, \"modal-header\", \"bg-primary\", \"text-white\"], [\"id\", \"modalCompanerosLabel\", 1, \"modal-title\"], [1, \"bi\", \"bi-people-fill\", \"me-2\"], [\"type\", \"button\", \"data-bs-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"btn-close\", \"btn-close-white\"], [1, \"modal-body\", \"p-4\"], [\"class\", \"alert alert-warning\", 4, \"ngIf\"], [3, \"asignaturaId\", \"estudianteActualId\", 4, \"ngIf\"], [1, \"modal-footer\"], [\"type\", \"button\", \"data-bs-dismiss\", \"modal\", 1, \"btn\", \"btn-secondary\"], [1, \"bi\", \"bi-x-circle\", \"me-1\"], [1, \"col-md-12\", \"text-center\"], [\"role\", \"status\", 1, \"spinner-border\", \"text-primary\"], [1, \"visually-hidden\"], [1, \"alert\", \"alert-danger\"], [1, \"alert\", \"alert-success\"], [1, \"text-center\", \"mt-3\"], [1, \"table-responsive\"], [1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [\"data-testid\", \"ver-companeros-btn\", 1, \"btn\", \"btn-sm\", \"btn-info\", \"me-2\", 3, \"id\", \"click\"], [1, \"bi\", \"bi-people\"], [1, \"btn\", \"btn-sm\", \"btn-danger\", 3, \"click\"], [1, \"bi\", \"bi-trash\"], [3, \"ngValue\"], [1, \"invalid-feedback\"], [1, \"alert\", \"alert-warning\", \"mt-3\"], [1, \"alert\", \"alert-warning\"], [3, \"asignaturaId\", \"estudianteActualId\"]],\n      template: function RegistroMateriasComponente_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h2\");\n          i0.ɵɵtext(4, \"Registro de Materias\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(5, \"hr\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(6, RegistroMateriasComponente_div_6_Template, 5, 0, \"div\", 3);\n          i0.ɵɵtemplate(7, RegistroMateriasComponente_div_7_Template, 4, 1, \"div\", 3);\n          i0.ɵɵtemplate(8, RegistroMateriasComponente_div_8_Template, 4, 1, \"div\", 3);\n          i0.ɵɵelementStart(9, \"div\", 4)(10, \"div\", 2)(11, \"div\", 5)(12, \"div\", 6)(13, \"h4\");\n          i0.ɵɵtext(14, \"Mis Materias Registradas\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(15, \"div\", 7);\n          i0.ɵɵelement(16, \"app-creditos-estudiante\", 8);\n          i0.ɵɵtemplate(17, RegistroMateriasComponente_div_17_Template, 3, 0, \"div\", 9);\n          i0.ɵɵtemplate(18, RegistroMateriasComponente_div_18_Template, 14, 1, \"div\", 10);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(19, \"div\", 1)(20, \"div\", 2)(21, \"div\", 5)(22, \"div\", 11)(23, \"h4\");\n          i0.ɵɵtext(24, \"Registrar Nueva Materia\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(25, \"div\", 7)(26, \"form\", 12);\n          i0.ɵɵlistener(\"ngSubmit\", function RegistroMateriasComponente_Template_form_ngSubmit_26_listener() {\n            return ctx.onSubmit();\n          });\n          i0.ɵɵelementStart(27, \"div\", 13)(28, \"label\", 14);\n          i0.ɵɵtext(29, \"Selecciona una Materia\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(30, \"select\", 15)(31, \"option\", 16);\n          i0.ɵɵtext(32, \"-- Selecciona una materia --\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(33, RegistroMateriasComponente_option_33_Template, 2, 4, \"option\", 17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(34, RegistroMateriasComponente_div_34_Template, 2, 0, \"div\", 18);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(35, \"div\", 19)(36, \"button\", 20);\n          i0.ɵɵelement(37, \"i\", 21);\n          i0.ɵɵtext(38, \" Registrar Materia \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(39, RegistroMateriasComponente_div_39_Template, 2, 1, \"div\", 22);\n          i0.ɵɵelementEnd()()()()()();\n          i0.ɵɵelementStart(40, \"div\", 23)(41, \"div\", 24)(42, \"div\", 25)(43, \"div\", 26)(44, \"h5\", 27);\n          i0.ɵɵelement(45, \"i\", 28);\n          i0.ɵɵtext(46, \"Compa\\u00F1eros de Clase \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(47, \"button\", 29);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(48, \"div\", 30);\n          i0.ɵɵtemplate(49, RegistroMateriasComponente_div_49_Template, 2, 0, \"div\", 31);\n          i0.ɵɵtemplate(50, RegistroMateriasComponente_app_companeros_50_Template, 1, 2, \"app-companeros\", 32);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(51, \"div\", 33)(52, \"button\", 34);\n          i0.ɵɵelement(53, \"i\", 35);\n          i0.ɵɵtext(54, \"Cerrar \");\n          i0.ɵɵelementEnd()()()()();\n        }\n        if (rf & 2) {\n          let tmp_7_0;\n          let tmp_9_0;\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngIf\", ctx.cargando);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.error);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.exito);\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"estudianteId\", ctx.estudianteId);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.inscripcionesActuales.length === 0);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.inscripcionesActuales.length > 0);\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"formGroup\", ctx.formularioInscripcion);\n          i0.ɵɵadvance(4);\n          i0.ɵɵclassProp(\"is-invalid\", ((tmp_7_0 = ctx.formularioInscripcion.get(\"asignaturaId\")) == null ? null : tmp_7_0.invalid) && ((tmp_7_0 = ctx.formularioInscripcion.get(\"asignaturaId\")) == null ? null : tmp_7_0.touched));\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngForOf\", ctx.asignaturasDisponibles);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_9_0 = ctx.formularioInscripcion.get(\"asignaturaId\")) == null ? null : tmp_9_0.invalid) && ((tmp_9_0 = ctx.formularioInscripcion.get(\"asignaturaId\")) == null ? null : tmp_9_0.touched));\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", ctx.formularioInscripcion.invalid || ctx.cargando || ctx.inscripcionesActuales.length >= ctx.maxAsignaturas);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.inscripcionesActuales.length >= ctx.maxAsignaturas);\n          i0.ɵɵadvance(10);\n          i0.ɵɵproperty(\"ngIf\", !ctx.asignaturaSeleccionadaId);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.asignaturaSeleccionadaId);\n        }\n      },\n      dependencies: [i6.NgForOf, i6.NgIf, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i7.CompanerosComponente, i8.CreditosEstudianteComponente],\n      styles: [\".card[_ngcontent-%COMP%] {\\n  margin-bottom: 20px;\\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\\n}\\n\\n.card-header[_ngcontent-%COMP%] {\\n  font-weight: 500;\\n}\\n\\n.list-group-item[_ngcontent-%COMP%] {\\n  transition: background-color 0.2s;\\n}\\n\\n.list-group-item[_ngcontent-%COMP%]:hover {\\n  background-color: #f8f9fa;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50ZXMvZXN0dWRpYW50ZXMvcmVnaXN0cm8tbWF0ZXJpYXMvcmVnaXN0cm8tbWF0ZXJpYXMuY29tcG9uZW50ZS5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxtQkFBbUI7RUFDbkIsd0NBQXdDO0FBQzFDOztBQUVBO0VBQ0UsZ0JBQWdCO0FBQ2xCOztBQUVBO0VBQ0UsaUNBQWlDO0FBQ25DOztBQUVBO0VBQ0UseUJBQXlCO0FBQzNCIiwic291cmNlc0NvbnRlbnQiOlsiLmNhcmQge1xuICBtYXJnaW4tYm90dG9tOiAyMHB4O1xuICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLCAwLCAwLCAwLjEpO1xufVxuXG4uY2FyZC1oZWFkZXIge1xuICBmb250LXdlaWdodDogNTAwO1xufVxuXG4ubGlzdC1ncm91cC1pdGVtIHtcbiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjJzO1xufVxuXG4ubGlzdC1ncm91cC1pdGVtOmhvdmVyIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2Y4ZjlmYTtcbn0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["Validators","firstValueFrom","CreditosEstudianteComponente","i0","RegistroMateriasComponente","constructor","formBuilder","asignaturaServicio","inscripcionServicio","autenticacionServicio","router","ngOnInit","iniciarFormulario","obtenerIdEstudianteActual","formularioInscripcion","group","asignaturaId","required","get","valueChanges","subscribe","value","console","log","cargando","usuario","obtenerValorUsuarioActual","error","studentId","role","obtenerPerfilUsuario","id","next","perfil","estudianteId","cargarInscripcionesActuales","cargarAsignaturasDisponibles","err","message","obtenerInscripcionesEstudiante","inscripciones","inscripcionesActuales","obtenerAsignaturasEstudiante","asignaturas","obtenerAsignaturas","idsAsignaturasRegistradas","map","reg","materiaId","asignaturasDisponibles","filter","asignatura","includes","onSubmit","invalid","exito","asignaturaIdRaw","parseInt","length","maxAsignaturas","forEach","a","nombre","asignaturaSeleccionada","find","creditosActuales","reduce","total","creditos","nuevoTotalCreditos","verificarConflictoProfesor","then","tieneConflicto","solicitudInscripcion","nombreEstudiante","name","nombreMateria","inscribirAsignatura","inscripcion","reset","setTimeout","componenteCreditos","actualizarCreditos","warn","catch","nuevaAsignaturaId","nuevaAsignatura","obtenerAsignatura","idsAsignaturasActuales","asignaturasActuales","obtenerAsignaturasPorIds","some","profesorId","desinscribirAsignatura","inscripcionId","confirm","abrirModalCompaneros","asignaturaSeleccionadaId","bootstrap","elementoModal","document","getElementById","modalExistente","Modal","getInstance","dispose","opcionesModal","backdrop","keyboard","focus","instanciaModal","style","display","zIndex","show","classList","contains","e","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["C:\\Users\\hansk\\Videos\\frontendsistemacolegio.interrapidisi\\frontendsistemacolegio.interrapidisi\\src\\app\\componentes\\estudiantes\\registro-materias\\registro-materias.componente.ts","C:\\Users\\hansk\\Videos\\frontendsistemacolegio.interrapidisi\\frontendsistemacolegio.interrapidisi\\src\\app\\componentes\\estudiantes\\registro-materias\\registro-materias.componente.html"],"sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Asignatura } from '../../../modelos/asignatura.modelo';\nimport { Inscripcion, SolicitudInscripcion } from '../../../modelos/inscripcion.modelo';\nimport { AsignaturaServicio } from '../../../servicios/asignatura.servicio';\nimport { InscripcionServicio } from '../../../servicios/inscripcion.servicio';\nimport { AutenticacionServicio } from '../../../servicios/autenticacion.servicio';\nimport { Router } from '@angular/router';\nimport { firstValueFrom } from 'rxjs';\nimport { CreditosEstudianteComponente } from '../creditos-estudiante/creditos-estudiante.componente';\n\n// Declaración para el objeto bootstrap global\ndeclare var bootstrap: any;\n\n@Component({\n  selector: 'app-registro-materias',\n  templateUrl: './registro-materias.componente.html',\n  styleUrls: ['./registro-materias.componente.css']\n})\nexport class RegistroMateriasComponente implements OnInit {\n  @ViewChild(CreditosEstudianteComponente) componenteCreditos!: CreditosEstudianteComponente;\n  \n  formularioInscripcion!: FormGroup;\n  asignaturasDisponibles: Asignatura[] = [];\n  inscripcionesActuales: Inscripcion[] = [];\n  asignaturas: Asignatura[] = []; // Para el cálculo de créditos\n  cargando = false;\n  error = '';\n  exito = '';\n  estudianteId: number = 0;\n  maxAsignaturas = 3;\n  asignaturaSeleccionadaId: number | null = null; // Para el modal de compañeros\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private asignaturaServicio: AsignaturaServicio,\n    private inscripcionServicio: InscripcionServicio,\n    private autenticacionServicio: AutenticacionServicio,\n    private router: Router\n  ) {}\n\n  ngOnInit(): void {\n    this.iniciarFormulario();\n    this.obtenerIdEstudianteActual();\n  }\n\n  iniciarFormulario(): void {\n    this.formularioInscripcion = this.formBuilder.group({\n      asignaturaId: [null, [Validators.required]]\n    });\n    \n    // Agregar un listener para depurar cambios en el valor del formulario\n    this.formularioInscripcion.get('asignaturaId')?.valueChanges.subscribe(value => {\n      console.log('Valor de asignaturaId cambiado a:', value, 'tipo:', typeof value);\n    });\n  }\n\n  obtenerIdEstudianteActual(): void {\n    this.cargando = true;\n    const usuario = this.autenticacionServicio.obtenerValorUsuarioActual();\n    console.log('Usuario autenticado:', usuario);\n    \n    if (!usuario) {\n      this.error = 'No se pudo obtener la información del usuario. Por favor, inicie sesión nuevamente.';\n      this.cargando = false;\n      return;\n    }\n    \n    console.log('ID de estudiante:', usuario.studentId);\n    \n    if (usuario.role !== 'student') {\n      this.error = 'Esta página es solo para estudiantes.';\n      this.cargando = false;\n      return;\n    }\n    \n    if (!usuario.studentId) {\n      // Si el usuario es estudiante pero no tiene studentId, intentamos obtenerlo del perfil\n      this.autenticacionServicio.obtenerPerfilUsuario(usuario.id).subscribe({\n        next: (perfil) => {\n          console.log('Perfil obtenido:', perfil);\n          if (perfil.studentId) {\n            this.estudianteId = perfil.studentId;\n            this.cargarInscripcionesActuales();\n            this.cargarAsignaturasDisponibles();\n          } else {\n            this.error = 'No se pudo identificar al estudiante. Por favor, contacte al administrador.';\n            this.cargando = false;\n          }\n        },\n        error: (err) => {\n          console.error('Error al obtener perfil:', err);\n          this.error = 'Error al obtener información del estudiante: ' + err.message;\n          this.cargando = false;\n        }\n      });\n    } else {\n      this.estudianteId = usuario.studentId;\n      this.cargarInscripcionesActuales();\n      this.cargarAsignaturasDisponibles();\n    }\n  }\n\n  cargarInscripcionesActuales(): void {\n    this.inscripcionServicio.obtenerInscripcionesEstudiante(this.estudianteId).subscribe({\n      next: (inscripciones) => {\n        this.inscripcionesActuales = inscripciones;\n        console.log('Inscripciones actuales cargadas:', this.inscripcionesActuales);\n        \n        // Cargar las asignaturas del estudiante para el cu00e1lculo de cru00e9ditos\n        this.asignaturaServicio.obtenerAsignaturasEstudiante(this.estudianteId).subscribe({\n          next: (asignaturas) => {\n            this.asignaturas = asignaturas;\n            console.log('Asignaturas del estudiante cargadas:', this.asignaturas);\n            this.cargando = false;\n          },\n          error: (err) => {\n            this.error = 'Error al cargar asignaturas del estudiante';\n            this.cargando = false;\n            console.error(err);\n          }\n        });\n      },\n      error: (err) => {\n        this.error = 'Error al cargar inscripciones actuales';\n        this.cargando = false;\n        console.error(err);\n      }\n    });\n  }\n\n  cargarAsignaturasDisponibles(): void {\n    this.asignaturaServicio.obtenerAsignaturas().subscribe({\n      next: (asignaturas) => {\n        // Filtrar materias ya registradas\n        const idsAsignaturasRegistradas = this.inscripcionesActuales.map(reg => reg.materiaId);\n        this.asignaturasDisponibles = asignaturas.filter(asignatura => !idsAsignaturasRegistradas.includes(asignatura.id));\n       console.log('Asignaturas disponibles:', this.asignaturasDisponibles);\n        this.cargando = false;\n      },\n      error: (err) => {\n        this.error = 'Error al cargar asignaturas disponibles';\n        this.cargando = false;\n        console.error(err);\n      }\n    });\n  }\n\n  onSubmit(): void {\n    if (this.formularioInscripcion.invalid) {\n      return;\n    }\n\n    this.cargando = true;\n    this.error = '';\n    this.exito = '';\n\n    // Obtener y convertir el ID de la asignatura a número para asegurar la comparación correcta\n    const asignaturaIdRaw = this.formularioInscripcion.value.asignaturaId;\n    const asignaturaId = typeof asignaturaIdRaw === 'string' ? parseInt(asignaturaIdRaw, 10) : asignaturaIdRaw;\n    \n    console.log('Procesando inscripción de asignatura:', asignaturaId, 'tipo:', typeof asignaturaId); \n    console.log('Formulario completo:', this.formularioInscripcion.value);\n    console.log('Asignaturas disponibles:', this.asignaturasDisponibles);\n    \n    // Verificar si ya tiene el máximo de materias\n    if (this.inscripcionesActuales.length >= this.maxAsignaturas) {\n      this.error = `No puedes registrar más de ${this.maxAsignaturas} materias`;\n      this.cargando = false;\n      return;\n    }\n\n    // Obtener la asignatura seleccionada para verificar sus créditos\n    console.log('Buscando asignatura con ID:', asignaturaId);\n    // Imprimir todas las asignaturas disponibles para depuración\n    this.asignaturasDisponibles.forEach(a => {\n      console.log(`Asignatura disponible - ID: ${a.id} (${typeof a.id}), Nombre: ${a.nombre}`);\n    });\n    \n    const asignaturaSeleccionada = this.asignaturasDisponibles.find(a => a.id === asignaturaId);\n    console.log('Asignatura seleccionada:', asignaturaSeleccionada);\n    \n    if (!asignaturaSeleccionada) {\n      this.error = 'No se pudo encontrar la información de la materia seleccionada';\n      this.cargando = false;\n      return;\n    }\n\n    // Calcular el total de créditos actuales\n    const creditosActuales = this.asignaturas.reduce((total, asignatura) => total + asignatura.creditos, 0);\n    const nuevoTotalCreditos = creditosActuales + asignaturaSeleccionada.creditos;\n    console.log('Créditos actuales:', creditosActuales, 'Nuevos créditos totales:', nuevoTotalCreditos);\n\n    // Verificar si supera el límite de 9 créditos\n    if (nuevoTotalCreditos > 9) {\n      this.error = `No puedes registrar esta materia porque superarías el límite de 9 créditos. Actualmente tienes ${creditosActuales} créditos y esta materia tiene ${asignaturaSeleccionada.creditos} créditos.`;\n      this.cargando = false;\n      return;\n    }\n\n    // Verificar si ya tiene una materia con el mismo profesor\n    this.verificarConflictoProfesor(asignaturaId).then(tieneConflicto => {\n      if (tieneConflicto) {\n        this.error = 'No puedes tener más de una materia con el mismo profesor';\n        this.cargando = false;\n        return;\n      }\n\n      // Proceder con el registro\n      const solicitudInscripcion: SolicitudInscripcion = {\n        estudianteId: this.estudianteId,\n        materiaId: asignaturaId,\n        nombreEstudiante: this.autenticacionServicio.obtenerValorUsuarioActual()?.name || '',\n        nombreMateria: asignaturaSeleccionada?.nombre || ''\n      };\n\n      this.inscripcionServicio.inscribirAsignatura(solicitudInscripcion).subscribe({\n        next: (inscripcion) => {\n          this.exito = 'Materia registrada correctamente';\n          this.cargando = false;\n          this.formularioInscripcion.reset();\n          // Recargar los datos\n          this.cargarInscripcionesActuales();\n          this.cargarAsignaturasDisponibles();          \n          // Actualizar el componente de cru00e9ditos\n          setTimeout(() => {\n            if (this.componenteCreditos) {\n              console.log('Actualizando componente de cru00e9ditos despuu00e9s de registrar materia');\n              this.componenteCreditos.actualizarCreditos();\n            } else {\n              console.warn('No se pudo acceder al componente de cru00e9ditos');\n            }\n          }, 500); // Pequeu00f1o retraso para asegurar que el componente estu00e9 disponible\n        },\n        error: (err: any) => {\n          this.error = err.message || 'Error al registrar la materia';\n          this.cargando = false;\n          console.error(err);\n        }\n      });\n    }).catch(err => {\n      this.error = 'Error al verificar conflictos de profesor';\n      this.cargando = false;\n      console.error(err);\n    });\n  }\n\n  async verificarConflictoProfesor(nuevaAsignaturaId: number): Promise<boolean> {\n    console.log('Verificando conflicto de profesor para asignatura ID:', nuevaAsignaturaId, 'tipo:', typeof nuevaAsignaturaId);\n    \n    // Si no hay registros actuales, no hay conflicto\n    if (this.inscripcionesActuales.length === 0) {\n      return false;\n    }\n\n    try {\n      // Obtener la nueva materia\n      const nuevaAsignatura = await firstValueFrom(this.asignaturaServicio.obtenerAsignatura(nuevaAsignaturaId));\n      console.log('Nueva asignatura obtenida:', nuevaAsignatura);\n      if (!nuevaAsignatura) return false;\n\n      // Obtener las materias actuales\n      const idsAsignaturasActuales = this.inscripcionesActuales.map(reg => reg.materiaId);\n      console.log('IDs de asignaturas actuales:', idsAsignaturasActuales);\n      const asignaturasActuales = await firstValueFrom(this.asignaturaServicio.obtenerAsignaturasPorIds(idsAsignaturasActuales));\n      console.log('Asignaturas actuales obtenidas:', asignaturasActuales);\n      if (!asignaturasActuales) return false;\n\n      // Verificar si hay conflicto de profesor\n      const tieneConflicto = asignaturasActuales.some(asignatura => asignatura.profesorId === nuevaAsignatura.profesorId);\n      console.log('¿Tiene conflicto de profesor?', tieneConflicto);\n      return tieneConflicto;\n    } catch (error) {\n      console.error('Error al verificar conflicto de profesor:', error);\n      return false;\n    }\n  }\n\n  desinscribirAsignatura(inscripcionId: number | undefined): void {\n    if (!inscripcionId) {\n      this.error = 'ID de inscripción no válido';\n      return;\n    }\n    \n    if (confirm('¿Estás seguro de que deseas eliminar esta materia?')) {\n      this.cargando = true;\n      this.error = '';\n      this.exito = '';\n\n      this.inscripcionServicio.desinscribirAsignatura(inscripcionId).subscribe({\n        next: () => {\n          this.exito = 'Materia eliminada correctamente';\n          this.cargando = false;\n          // Recargar los datos\n          this.cargarInscripcionesActuales();\n          this.cargarAsignaturasDisponibles();\n        },\n        error: (err) => {          \n          // Actualizar el componente de créditos\n          setTimeout(() => {\n            if (this.componenteCreditos) {\n              console.log('Actualizando componente de créditos después de eliminar materia');\n              this.componenteCreditos.actualizarCreditos();\n            } else {\n              console.warn('No se pudo acceder al componente de créditos');\n            }\n          }, 500); // Pequeño retraso para asegurar que el componente esté disponible          this.error = 'Error al eliminar la materia';\n          this.cargando = false;\n          console.error(err);\n        }\n      });\n    }\n  }\n\n  // Método para abrir el modal de compañeros\n  abrirModalCompaneros(asignaturaId: number): void {\n    if (!asignaturaId) {\n      this.error = 'Error: No se pudo identificar la materia seleccionada';\n      setTimeout(() => this.error = '', 3000); // Limpiar el mensaje después de 3 segundos\n      return;\n    }\n    \n    this.asignaturaSeleccionadaId = asignaturaId;\n    \n    try {\n      // Asegurarse de que Bootstrap esté disponible\n      if (typeof bootstrap === 'undefined') {\n        console.error('Bootstrap no está disponible');\n        this.error = 'Error al mostrar la ventana modal. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n        return;\n      }\n      \n      // Usar Bootstrap 5 para abrir el modal\n      const elementoModal: HTMLElement | null = document.getElementById('modalCompaneros');\n      if (elementoModal) {\n        // Asegurarse de que cualquier modal previo se cierre\n        const modalExistente = bootstrap.Modal.getInstance(elementoModal);\n        if (modalExistente) {\n          modalExistente.dispose();\n        }\n        \n        // Crear una nueva instancia del modal con opciones específicas\n        const opcionesModal = {\n          backdrop: 'static',  // El modal no se cierra al hacer clic fuera\n          keyboard: true,     // Se puede cerrar con la tecla ESC\n          focus: true         // Enfoca el modal cuando se abre\n        };\n        \n        const instanciaModal = new bootstrap.Modal(elementoModal, opcionesModal);\n        \n        // Asegurarse de que el modal esté visible\n        elementoModal.style.display = 'block';\n        elementoModal.style.zIndex = '1050';\n        \n        instanciaModal.show();\n        \n        // Verificar que el modal se haya abierto correctamente\n        setTimeout(() => {\n          if (elementoModal.classList.contains('show')) {\n            console.log('Modal mostrado correctamente');\n          } else {\n            console.error('El modal no se mostró correctamente');\n            this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n            setTimeout(() => this.error = '', 3000);\n          }\n        }, 500);\n      } else {\n        console.error('No se encontró el elemento del modal con ID: classmatesModal');\n        this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n      }\n    } catch (e) {\n      console.error('Error al abrir el modal:', e);\n      this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n      setTimeout(() => this.error = '', 3000);\n    }\n  }\n}","<div class=\"container mt-4\">\n  <div class=\"row\">\n    <div class=\"col-md-12\">\n      <h2>Registro de Materias</h2>\n      <hr>\n    </div>\n  </div>\n\n  <div class=\"row\" *ngIf=\"cargando\">\n    <div class=\"col-md-12 text-center\">\n      <div class=\"spinner-border text-primary\" role=\"status\">\n        <span class=\"visually-hidden\">Cargando...</span>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"row\" *ngIf=\"error\">\n    <div class=\"col-md-12\">\n      <div class=\"alert alert-danger\">\n        {{ error }}\n      </div>\n    </div>\n  </div>\n\n  <div class=\"row\" *ngIf=\"exito\">\n    <div class=\"col-md-12\">\n      <div class=\"alert alert-success\">\n        {{ exito }}\n      </div>\n    </div>\n  </div>\n\n  <!-- Materias Actuales -->\n  <div class=\"row mb-4\">\n    <div class=\"col-md-12\">\n      <div class=\"card\">\n        <div class=\"card-header bg-primary text-white\">\n          <h4>Mis Materias Registradas</h4>\n        </div>\n        <div class=\"card-body\">\n          <app-creditos-estudiante [estudianteId]=\"estudianteId\"></app-creditos-estudiante>\n          \n          <div *ngIf=\"inscripcionesActuales.length === 0\" class=\"text-center mt-3\">\n            <p>No tienes materias registradas.</p>\n          </div>\n          \n          <div *ngIf=\"inscripcionesActuales.length > 0\" class=\"table-responsive\">\n            <table class=\"table table-striped\">\n              <thead>\n                <tr>\n                  <th>Materia</th>\n                  <th>Profesor</th>\n                  <th>Créditos</th>\n                  <th>Acciones</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let inscripcion of inscripcionesActuales\">\n                  <td>{{ inscripcion.nombreMateria }}</td>\n                  <td>{{ inscripcion.nombreProfesor }}</td>\n                  <td>{{ inscripcion.creditos }}</td>\n                  <td>\n                    <button class=\"btn btn-sm btn-info me-2\" (click)=\"abrirModalCompaneros(inscripcion.materiaId)\" id=\"btnVerCompaneros-{{inscripcion.materiaId}}\" data-testid=\"ver-companeros-btn\">\n                      <i class=\"bi bi-people\"></i> Ver Compañeros\n                    </button>\n                    <button class=\"btn btn-sm btn-danger\" (click)=\"desinscribirAsignatura(inscripcion.id)\">\n                      <i class=\"bi bi-trash\"></i> Eliminar\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Formulario de Registro -->\n  <div class=\"row\">\n    <div class=\"col-md-12\">\n      <div class=\"card\">\n        <div class=\"card-header bg-success text-white\">\n          <h4>Registrar Nueva Materia</h4>\n        </div>\n        <div class=\"card-body\">\n          <form [formGroup]=\"formularioInscripcion\" (ngSubmit)=\"onSubmit()\">\n            <div class=\"mb-3\">\n              <label for=\"asignaturaId\" class=\"form-label\">Selecciona una Materia</label>\n              <select id=\"asignaturaId\" formControlName=\"asignaturaId\" class=\"form-select\" \n                      [class.is-invalid]=\"formularioInscripcion.get('asignaturaId')?.invalid && formularioInscripcion.get('asignaturaId')?.touched\">\n                <option value=\"\">-- Selecciona una materia --</option>\n                <option *ngFor=\"let asignatura of asignaturasDisponibles\" [ngValue]=\"asignatura.id\">\n                  {{ asignatura.nombre }} - Prof. {{ asignatura.profesor?.nombre }} ({{ asignatura.creditos }} créditos)\n                </option>\n              </select>\n              <div *ngIf=\"formularioInscripcion.get('asignaturaId')?.invalid && formularioInscripcion.get('asignaturaId')?.touched\" class=\"invalid-feedback\">\n                Debes seleccionar una materia.\n              </div>\n            </div>\n            \n            <div class=\"d-grid gap-2\">\n              <button type=\"submit\" class=\"btn btn-success\" [disabled]=\"formularioInscripcion.invalid || cargando || inscripcionesActuales.length >= maxAsignaturas\">\n                <i class=\"bi bi-plus-circle\"></i> Registrar Materia\n              </button>\n            </div>\n            \n            <div *ngIf=\"inscripcionesActuales.length >= maxAsignaturas\" class=\"alert alert-warning mt-3\">\n              Has alcanzado el límite máximo de {{ maxAsignaturas }} materias.\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<!-- Modal para mostrar compañeros -->\n<div class=\"modal fade\" id=\"modalCompaneros\" tabindex=\"-1\" aria-labelledby=\"modalCompanerosLabel\" aria-hidden=\"true\" data-testid=\"classmates-modal\">\n  <div class=\"modal-dialog modal-dialog-centered modal-lg\">\n    <div class=\"modal-content shadow\">\n      <div class=\"modal-header bg-primary text-white\">\n        <h5 class=\"modal-title\" id=\"modalCompanerosLabel\">\n          <i class=\"bi bi-people-fill me-2\"></i>Compañeros de Clase\n        </h5>\n        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n      </div>\n      <div class=\"modal-body p-4\">\n        <div *ngIf=\"!asignaturaSeleccionadaId\" class=\"alert alert-warning\">\n          No se ha seleccionado ninguna materia.\n        </div>\n        <app-companeros *ngIf=\"asignaturaSeleccionadaId\" [asignaturaId]=\"asignaturaSeleccionadaId\" [estudianteActualId]=\"estudianteId\"></app-companeros>\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">\n          <i class=\"bi bi-x-circle me-1\"></i>Cerrar\n        </button>\n      </div>\n    </div>\n  </div>\n</div>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}