{"ast":null,"code":"import { throwError, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AsignaturaServicio {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = `${environment.apiUrl}/Materias`;\n    this.registrosUrl = `${environment.apiUrl}/Registros`;\n  }\n  crearObjetoProfesor(id, nombreCompleto) {\n    const [nombre, apellido] = nombreCompleto.split(' ').length > 1 ? [nombreCompleto.split(' ')[0], nombreCompleto.split(' ').slice(1).join(' ')] : [nombreCompleto, ''];\n    return {\n      id: id,\n      nombre: nombre,\n      apellido: apellido,\n      email: '',\n      departamento: '',\n      nombreCompleto: nombreCompleto\n    };\n  }\n  obtenerAsignaturasEstudiante(estudianteId) {\n    return this.http.get(`${this.apiUrl}/estudiante/${estudianteId}`).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        return respuesta.data.map(item => ({\n          id: item.id,\n          nombre: item.nombre,\n          codigo: item.codigo,\n          creditos: item.creditos,\n          profesorId: item.profesorId || 0,\n          profesor: item.nombreProfesor ? this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) : undefined\n        }));\n      }\n      return [];\n    }), catchError(this.manejarError));\n  }\n  obtenerAsignaturas(esProfesor = false) {\n    if (esProfesor) {\n      return this.http.get(`${this.apiUrl}/profesor-materias`).pipe(map(respuesta => {\n        if (respuesta && respuesta.exito && respuesta.data && respuesta.data.materias) {\n          return respuesta.data.materias.map(item => ({\n            id: item.id,\n            nombre: item.nombre,\n            codigo: item.codigo,\n            creditos: item.creditos,\n            profesorId: item.profesorId || 0,\n            profesor: item.nombreProfesor ? this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) : undefined\n          }));\n        }\n        return [];\n      }), catchError(this.manejarError));\n    }\n    return this.http.get(this.apiUrl).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        return respuesta.data.map(item => ({\n          id: item.id,\n          nombre: item.nombre,\n          codigo: item.codigo,\n          creditos: item.creditos,\n          profesorId: item.profesorId || 0,\n          profesor: item.nombreProfesor ? this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) : undefined\n        }));\n      }\n      return [];\n    }), catchError(this.manejarError));\n  }\n  obtenerAsignatura(id) {\n    return this.http.get(`${this.apiUrl}/${id}`).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        const item = respuesta.data;\n        return {\n          id: item.id,\n          nombre: item.nombre,\n          codigo: item.codigo,\n          creditos: item.creditos,\n          profesorId: item.profesorId || 0,\n          profesor: item.nombreProfesor ? this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) : undefined\n        };\n      }\n      throw new Error('Asignatura no encontrada');\n    }), catchError(this.manejarError));\n  }\n  obtenerAsignaturasPorIds(ids) {\n    // Si solo hay un ID, usar el endpoint de obtener una asignatura\n    if (ids.length === 1) {\n      return this.obtenerAsignatura(ids[0]).pipe(map(asignatura => [asignatura]), catchError(error => {\n        console.error('Error al obtener asignatura por ID único:', error);\n        return of([]);\n      }));\n    }\n    // Si hay múltiples IDs, intentar obtener cada asignatura individualmente\n    // y combinar los resultados\n    console.log('Obteniendo múltiples asignaturas por IDs individuales:', ids);\n    // Crear un array de observables, uno para cada ID\n    const observables = ids.map(id => this.obtenerAsignatura(id).pipe(catchError(error => {\n      console.error(`Error al obtener asignatura ID ${id}:`, error);\n      return of(null); // Devolver null para las asignaturas que no se pueden obtener\n    })));\n    // Combinar todos los observables y filtrar los resultados nulos\n    return forkJoin(observables).pipe(map(asignaturas => asignaturas.filter(a => a !== null)), catchError(error => {\n      console.error('Error al combinar resultados de asignaturas:', error);\n      return of([]);\n    }));\n  }\n  obtenerEstudiantesPorAsignatura(id, esProfesor = false) {\n    if (esProfesor) {\n      return this.http.get(`${environment.apiUrl}/Estudiantes/por-materia-profesor/${id}`, {\n        observe: 'response'\n      }).pipe(map(respuesta => {\n        if (respuesta.body && respuesta.body.exito && respuesta.body.data) {\n          return respuesta.body.data.map(item => ({\n            id: item.id,\n            nombre: item.nombre,\n            matricula: item.matricula || '',\n            email: item.email || ''\n          }));\n        }\n        return [];\n      }), catchError(error => {\n        if (error.status === 403) {\n          return throwError(() => new Error('SIN_PERMISOS'));\n        } else if (error.status === 404) {\n          return throwError(() => new Error('NO_ENCONTRADO'));\n        }\n        return this.manejarError(error);\n      }));\n    }\n    return this.http.get(`${environment.apiUrl}/Registros/materia/${id}`).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        return respuesta.data.map(item => ({\n          id: item.estudianteId,\n          nombre: item.nombreEstudiante,\n          matricula: '',\n          email: ''\n        }));\n      }\n      return [];\n    }), catchError(this.manejarError));\n  }\n  crearAsignatura(asignaturaDto) {\n    return this.http.post(this.apiUrl, asignaturaDto).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        const item = respuesta.data;\n        return {\n          id: item.id,\n          nombre: item.nombre,\n          codigo: item.codigo,\n          creditos: item.creditos,\n          profesorId: item.profesorId || 0,\n          profesor: item.nombreProfesor ? this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) : undefined\n        };\n      }\n      throw new Error('Error al crear la asignatura');\n    }), catchError(this.manejarError));\n  }\n  actualizarAsignatura(asignatura) {\n    return this.http.put(`${this.apiUrl}/${asignatura.id}`, asignatura).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito && respuesta.data) {\n        const item = respuesta.data;\n        return {\n          id: item.id,\n          nombre: item.nombre,\n          codigo: item.codigo,\n          creditos: item.creditos,\n          profesorId: item.profesorId || 0,\n          profesor: item.nombreProfesor ? this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) : undefined\n        };\n      }\n      throw new Error('Error al actualizar la asignatura');\n    }), catchError(this.manejarError));\n  }\n  verificarInscripcion(asignaturaId, estudianteId) {\n    return this.http.get(`${this.registrosUrl}/student/${asignaturaId}/${estudianteId}`).pipe(map(respuesta => {\n      if (respuesta && respuesta.exito) {\n        return respuesta.data;\n      }\n      return false;\n    }), catchError(error => {\n      console.error('Error al verificar inscripción:', error);\n      return of(false);\n    }));\n  }\n  manejarError(error) {\n    let mensajeError = '¡Ocurrió un error desconocido!';\n    if (error.error instanceof ErrorEvent) {\n      mensajeError = `Error: ${error.error.message}`;\n    } else if (error.error && error.error.message) {\n      mensajeError = error.error.message;\n    } else if (error.status) {\n      mensajeError = `Error ${error.status}: ${error.statusText}`;\n    }\n    return throwError(() => new Error(mensajeError));\n  }\n  static {\n    this.ɵfac = function AsignaturaServicio_Factory(t) {\n      return new (t || AsignaturaServicio)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AsignaturaServicio,\n      factory: AsignaturaServicio.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["throwError","of","catchError","map","environment","AsignaturaServicio","constructor","http","apiUrl","crearObjetoProfesor","id","nombreCompleto","nombre","apellido","split","length","slice","join","email","departamento","obtenerAsignaturasEstudiante","estudianteId","get","pipe","respuesta","exito","data","item","codigo","creditos","profesorId","profesor","nombreProfesor","undefined","manejarError","obtenerAsignaturas","esProfesor","materias","obtenerAsignatura","Error","obtenerAsignaturasPorIds","ids","asignatura","error","console","log","observables","forkJoin","asignaturas","filter","a","obtenerEstudiantesPorAsignatura","observe","body","matricula","status","nombreEstudiante","crearAsignatura","asignaturaDto","post","actualizarAsignatura","put","verificarInscripcion","asignaturaId","registrosUrl","mensajeError","ErrorEvent","message","statusText","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\hansk\\Videos\\frontendsistemacolegio.interrapidisi\\frontendsistemacolegio.interrapidisi\\src\\app\\servicios\\asignatura.servicio.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, throwError, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { Asignatura } from '../modelos/asignatura.modelo';\nimport { Estudiante } from '../modelos/estudiante.modelo';\nimport { Profesor } from '../modelos/profesor.modelo';\nimport { environment } from '../../environments/environment';\n\ninterface AsignaturaDto {\n  nombre: string;\n  codigo: string;\n  creditos: number;\n  profesorId: number | null;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AsignaturaServicio {\n  private apiUrl = `${environment.apiUrl}/Materias`;\n  private registrosUrl = `${environment.apiUrl}/Registros`;\n\n  constructor(private http: HttpClient) { }\n\n  private crearObjetoProfesor(id: any, nombreCompleto: string): Profesor {\n    const [nombre, apellido] = nombreCompleto.split(' ').length > 1 ?\n      [nombreCompleto.split(' ')[0], nombreCompleto.split(' ').slice(1).join(' ')] :\n      [nombreCompleto, ''];\n    return {\n      id: id,\n      nombre: nombre,\n      apellido: apellido,\n      email: '',\n      departamento: '',\n      nombreCompleto: nombreCompleto\n    };\n  }\n\n  obtenerAsignaturasEstudiante(estudianteId: number): Observable<Asignatura[]> {\n    return this.http.get<any>(`${this.apiUrl}/estudiante/${estudianteId}`)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            return respuesta.data.map((item: any) => ({\n              id: item.id,\n              nombre: item.nombre,\n              codigo: item.codigo,\n              creditos: item.creditos,\n              profesorId: item.profesorId || 0,\n              profesor: item.nombreProfesor ?\n                this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) :\n                undefined\n            }));\n          }\n          return [];\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  obtenerAsignaturas(esProfesor: boolean = false): Observable<Asignatura[]> {\n    if (esProfesor) {\n      return this.http.get<any>(`${this.apiUrl}/profesor-materias`).pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data && respuesta.data.materias) {\n            return respuesta.data.materias.map((item: any) => ({\n              id: item.id,\n              nombre: item.nombre,\n              codigo: item.codigo,\n              creditos: item.creditos,\n              profesorId: item.profesorId || 0,\n              profesor: item.nombreProfesor ?\n                this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) :\n                undefined\n            }));\n          }\n          return [];\n        }),\n        catchError(this.manejarError)\n      );\n    }\n    return this.http.get<any>(this.apiUrl)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            return respuesta.data.map((item: any) => ({\n              id: item.id,\n              nombre: item.nombre,\n              codigo: item.codigo,\n              creditos: item.creditos,\n              profesorId: item.profesorId || 0,\n              profesor: item.nombreProfesor ?\n                this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) :\n                undefined\n            }));\n          }\n          return [];\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  obtenerAsignatura(id: number): Observable<Asignatura> {\n    return this.http.get<any>(`${this.apiUrl}/${id}`)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            const item = respuesta.data;\n            return {\n              id: item.id,\n              nombre: item.nombre,\n              codigo: item.codigo,\n              creditos: item.creditos,\n              profesorId: item.profesorId || 0,\n              profesor: item.nombreProfesor ?\n                this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) :\n                undefined\n            };\n          }\n          throw new Error('Asignatura no encontrada');\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  obtenerAsignaturasPorIds(ids: number[]): Observable<Asignatura[]> {\n    // Si solo hay un ID, usar el endpoint de obtener una asignatura\n    if (ids.length === 1) {\n      return this.obtenerAsignatura(ids[0]).pipe(\n        map(asignatura => [asignatura]),\n        catchError(error => {\n          console.error('Error al obtener asignatura por ID único:', error);\n          return of([]);\n        })\n      );\n    }\n    \n    // Si hay múltiples IDs, intentar obtener cada asignatura individualmente\n    // y combinar los resultados\n    console.log('Obteniendo múltiples asignaturas por IDs individuales:', ids);\n    \n    // Crear un array de observables, uno para cada ID\n    const observables = ids.map(id => \n      this.obtenerAsignatura(id).pipe(\n        catchError(error => {\n          console.error(`Error al obtener asignatura ID ${id}:`, error);\n          return of(null); // Devolver null para las asignaturas que no se pueden obtener\n        })\n      )\n    );\n    \n    // Combinar todos los observables y filtrar los resultados nulos\n    return forkJoin(observables).pipe(\n      map(asignaturas => asignaturas.filter(a => a !== null) as Asignatura[]),\n      catchError(error => {\n        console.error('Error al combinar resultados de asignaturas:', error);\n        return of([]);\n      })\n    );\n  }\n\n  obtenerEstudiantesPorAsignatura(id: number, esProfesor: boolean = false): Observable<Estudiante[]> {\n    if (esProfesor) {\n      return this.http.get<any>(`${environment.apiUrl}/Estudiantes/por-materia-profesor/${id}`, { observe: 'response' })\n        .pipe(\n          map(respuesta => {\n            if (respuesta.body && respuesta.body.exito && respuesta.body.data) {\n              return respuesta.body.data.map((item: any) => ({\n                id: item.id,\n                nombre: item.nombre,\n                matricula: item.matricula || '',\n                email: item.email || ''\n              }));\n            }\n            return [];\n          }),\n          catchError((error) => {\n            if (error.status === 403) {\n              return throwError(() => new Error('SIN_PERMISOS'));\n            } else if (error.status === 404) {\n              return throwError(() => new Error('NO_ENCONTRADO'));\n            }\n            return this.manejarError(error);\n          })\n        );\n    }\n    return this.http.get<any>(`${environment.apiUrl}/Registros/materia/${id}`)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            return respuesta.data.map((item: any) => ({\n              id: item.estudianteId,\n              nombre: item.nombreEstudiante,\n              matricula: '',\n              email: '',\n            }));\n          }\n          return [];\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  crearAsignatura(asignaturaDto: AsignaturaDto): Observable<Asignatura> {\n    return this.http.post<any>(this.apiUrl, asignaturaDto)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            const item = respuesta.data;\n            return {\n              id: item.id,\n              nombre: item.nombre,\n              codigo: item.codigo,\n              creditos: item.creditos,\n              profesorId: item.profesorId || 0,\n              profesor: item.nombreProfesor ?\n                this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) :\n                undefined\n            };\n          }\n          throw new Error('Error al crear la asignatura');\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  actualizarAsignatura(asignatura: Asignatura): Observable<Asignatura> {\n    return this.http.put<any>(`${this.apiUrl}/${asignatura.id}`, asignatura)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito && respuesta.data) {\n            const item = respuesta.data;\n            return {\n              id: item.id,\n              nombre: item.nombre,\n              codigo: item.codigo,\n              creditos: item.creditos,\n              profesorId: item.profesorId || 0,\n              profesor: item.nombreProfesor ?\n                this.crearObjetoProfesor(item.profesorId, item.nombreProfesor) :\n                undefined\n            };\n          }\n          throw new Error('Error al actualizar la asignatura');\n        }),\n        catchError(this.manejarError)\n      );\n  }\n\n  verificarInscripcion(asignaturaId: number, estudianteId: number): Observable<boolean> {\n    return this.http.get<any>(`${this.registrosUrl}/student/${asignaturaId}/${estudianteId}`)\n      .pipe(\n        map(respuesta => {\n          if (respuesta && respuesta.exito) {\n            return respuesta.data;\n          }\n          return false;\n        }),\n        catchError(error => {\n          console.error('Error al verificar inscripción:', error);\n          return of(false);\n        })\n      );\n  }\n\n  private manejarError(error: any) {\n    let mensajeError = '¡Ocurrió un error desconocido!';\n    if (error.error instanceof ErrorEvent) {\n      mensajeError = `Error: ${error.error.message}`;\n    } else if (error.error && error.error.message) {\n      mensajeError = error.error.message;\n    } else if (error.status) {\n      mensajeError = `Error ${error.status}: ${error.statusText}`;\n    }\n    return throwError(() => new Error(mensajeError));\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}