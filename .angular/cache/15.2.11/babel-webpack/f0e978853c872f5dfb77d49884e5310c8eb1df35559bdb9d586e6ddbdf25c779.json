{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/hansk/Videos/frontendsistemacolegio.interrapidisi/frontendsistemacolegio.interrapidisi/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Validators } from '@angular/forms';\nimport { firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/subject.service\";\nimport * as i3 from \"../../services/registration.service\";\nimport * as i4 from \"../../services/auth.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"../../services/modal.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../student-credits/student-credits.component\";\nimport * as i9 from \"../classmates/classmates.component\";\nfunction SubjectRegistrationComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 38)(2, \"div\", 39)(3, \"span\", 40);\n    i0.ɵɵtext(4, \"Cargando...\");\n    i0.ɵɵelementEnd()()()();\n  }\n}\nfunction SubjectRegistrationComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 41);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.error, \" \");\n  }\n}\nfunction SubjectRegistrationComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 42);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.success, \" \");\n  }\n}\nfunction SubjectRegistrationComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 43)(1, \"p\");\n    i0.ɵɵtext(2, \"No tienes materias registradas.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction SubjectRegistrationComponent_div_18_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\")(8, \"button\", 47);\n    i0.ɵɵlistener(\"click\", function SubjectRegistrationComponent_div_18_tr_13_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const reg_r11 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.openClassmatesModal(reg_r11.subjectId));\n    });\n    i0.ɵɵelement(9, \"i\", 48);\n    i0.ɵɵtext(10, \" Ver Compa\\u00F1eros \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"button\", 49);\n    i0.ɵɵlistener(\"click\", function SubjectRegistrationComponent_div_18_tr_13_Template_button_click_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const reg_r11 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r14.unregisterSubject(reg_r11.id));\n    });\n    i0.ɵɵelement(12, \"i\", 50);\n    i0.ɵɵtext(13, \" Eliminar \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const reg_r11 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reg_r11.subject == null ? null : reg_r11.subject.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reg_r11.subject == null ? null : reg_r11.subject.professor == null ? null : reg_r11.subject.professor.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reg_r11.subject == null ? null : reg_r11.subject.credits);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"btnVerCompaneros-\", reg_r11.subjectId, \"\");\n  }\n}\nfunction SubjectRegistrationComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 44)(1, \"table\", 45)(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Materia\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Profesor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Cr\\u00E9ditos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Acciones\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, SubjectRegistrationComponent_div_18_tr_13_Template, 14, 4, \"tr\", 46);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.currentRegistrations);\n  }\n}\nfunction SubjectRegistrationComponent_option_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 51);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const subject_r15 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", subject_r15.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\" \", subject_r15.name, \" - Prof. \", subject_r15.professor == null ? null : subject_r15.professor.name, \" (\", subject_r15.credits, \" cr\\u00E9ditos) \");\n  }\n}\nfunction SubjectRegistrationComponent_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 52);\n    i0.ɵɵtext(1, \" Debes seleccionar una materia. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction SubjectRegistrationComponent_div_44_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 53);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Has alcanzado el l\\u00EDmite m\\u00E1ximo de \", ctx_r7.maxSubjects, \" materias. \");\n  }\n}\nfunction SubjectRegistrationComponent_div_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 54);\n    i0.ɵɵtext(1, \" No se ha seleccionado ninguna materia. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction SubjectRegistrationComponent_app_classmates_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-classmates\", 55);\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"subjectId\", ctx_r9.selectedSubjectId)(\"currentStudentId\", ctx_r9.studentId);\n  }\n}\nexport class SubjectRegistrationComponent {\n  constructor(formBuilder, subjectService, registrationService, authService, router, modalService) {\n    this.formBuilder = formBuilder;\n    this.subjectService = subjectService;\n    this.registrationService = registrationService;\n    this.authService = authService;\n    this.router = router;\n    this.modalService = modalService;\n    this.availableSubjects = [];\n    this.currentRegistrations = [];\n    this.loading = false;\n    this.error = '';\n    this.success = '';\n    this.studentId = 0;\n    this.maxSubjects = 3;\n    this.selectedSubjectId = null; // Para el modal de compañeros\n    this.currentTotalCredits = 0;\n    this.maxCredits = 9;\n    this.selectedSubjectCredits = 0;\n    this.wouldExceedCreditLimit = false;\n  }\n  ngOnInit() {\n    this.initForm();\n    this.getCurrentStudentId();\n  }\n  initForm() {\n    this.registrationForm = this.formBuilder.group({\n      subjectId: ['', [Validators.required]]\n    });\n    // Escuchar cambios en la selecciu00f3n de materia\n    this.registrationForm.get('subjectId')?.valueChanges.subscribe(subjectId => {\n      if (subjectId) {\n        const selectedSubject = this.availableSubjects.find(s => s.id === +subjectId);\n        if (selectedSubject) {\n          this.selectedSubjectCredits = selectedSubject.credits;\n          this.checkCreditLimit();\n        }\n      } else {\n        this.selectedSubjectCredits = 0;\n        this.wouldExceedCreditLimit = false;\n      }\n    });\n  }\n  checkCreditLimit() {\n    if (this.selectedSubjectCredits > 0) {\n      this.wouldExceedCreditLimit = this.currentTotalCredits + this.selectedSubjectCredits > this.maxCredits;\n    } else {\n      this.wouldExceedCreditLimit = false;\n    }\n  }\n  getCurrentStudentId() {\n    this.loading = true;\n    this.authService.getCurrentUser().subscribe({\n      next: user => {\n        if (user && user.id) {\n          this.studentId = user.id;\n          this.loadCurrentRegistrations();\n          this.loadAvailableSubjects();\n        } else {\n          this.error = 'No se pudo obtener la información del estudiante';\n          this.loading = false;\n        }\n      },\n      error: err => {\n        this.error = 'Error al obtener información del usuario';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n  loadCurrentRegistrations() {\n    this.registrationService.getStudentRegistrations(this.studentId).subscribe({\n      next: registrations => {\n        this.currentRegistrations = registrations;\n        this.loading = false;\n        // Cargar los créditos actuales\n        this.loadCurrentCredits();\n      },\n      error: err => {\n        this.error = 'Error al cargar registros actuales';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n  loadCurrentCredits() {\n    this.registrationService.getStudentTotalCredits(this.studentId).subscribe({\n      next: credits => {\n        this.currentTotalCredits = credits;\n        this.checkCreditLimit();\n      },\n      error: err => {\n        console.error('Error al cargar créditos actuales:', err);\n      }\n    });\n  }\n  loadAvailableSubjects() {\n    this.subjectService.getSubjects().subscribe({\n      next: subjects => {\n        // Filtrar materias ya registradas\n        const registeredSubjectIds = this.currentRegistrations.map(reg => reg.subjectId);\n        this.availableSubjects = subjects.filter(subject => !registeredSubjectIds.includes(subject.id));\n        this.loading = false;\n      },\n      error: err => {\n        this.error = 'Error al cargar materias disponibles';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n  onSubmit() {\n    if (this.registrationForm.invalid) {\n      return;\n    }\n    this.loading = true;\n    this.error = '';\n    this.success = '';\n    const subjectId = this.registrationForm.value.subjectId;\n    // Verificar si ya tiene el máximo de materias\n    if (this.currentRegistrations.length >= this.maxSubjects) {\n      this.error = `No puedes registrar más de ${this.maxSubjects} materias`;\n      this.loading = false;\n      return;\n    }\n    // Obtener la materia seleccionada\n    const selectedSubject = this.availableSubjects.find(s => s.id === subjectId);\n    if (!selectedSubject) {\n      this.error = 'No se encontró la materia seleccionada';\n      this.loading = false;\n      return;\n    }\n    // Verificar si al agregar esta materia se excede el límite de 9 créditos\n    this.registrationService.getStudentTotalCredits(this.studentId).subscribe({\n      next: currentCredits => {\n        // Verificar si al agregar esta materia se excede el límite de 9 créditos\n        if (currentCredits + selectedSubject.credits > 9) {\n          this.error = `No puedes registrar esta materia porque excederías el límite de 9 créditos. Actualmente tienes ${currentCredits} créditos y esta materia tiene ${selectedSubject.credits} créditos.`;\n          this.loading = false;\n          return;\n        }\n        // Verificar si ya tiene una materia con el mismo profesor\n        this.checkProfessorConflict(subjectId).then(hasConflict => {\n          if (hasConflict) {\n            this.error = 'No puedes tener más de una materia con el mismo profesor';\n            this.loading = false;\n            return;\n          }\n          // Proceder con el registro\n          const registrationRequest = {\n            studentId: this.studentId,\n            subjectId: subjectId,\n            studentName: this.authService.getCurrentUserValue()?.name || '',\n            subjectName: selectedSubject.name || ''\n          };\n          this.registrationService.registerSubject(registrationRequest).subscribe({\n            next: registration => {\n              this.success = 'Materia registrada correctamente';\n              this.loading = false;\n              this.registrationForm.reset();\n              // Recargar los datos\n              this.loadCurrentRegistrations();\n              this.loadAvailableSubjects();\n            },\n            error: err => {\n              this.error = err.message || 'Error al registrar la materia';\n              this.loading = false;\n              console.error(err);\n            }\n          });\n        }).catch(err => {\n          this.error = 'Error al verificar conflictos de profesor';\n          this.loading = false;\n          console.error(err);\n        });\n      },\n      error: err => {\n        this.error = 'Error al verificar los créditos actuales';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n  checkProfessorConflict(newSubjectId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      // Si no hay registros actuales, no hay conflicto\n      if (_this.currentRegistrations.length === 0) {\n        return false;\n      }\n      try {\n        // Obtener la nueva materia\n        const newSubject = yield firstValueFrom(_this.subjectService.getSubject(newSubjectId));\n        if (!newSubject) return false;\n        // Obtener las materias actuales\n        const currentSubjectIds = _this.currentRegistrations.map(reg => reg.subjectId);\n        const currentSubjects = yield firstValueFrom(_this.subjectService.getSubjectsByIds(currentSubjectIds));\n        if (!currentSubjects) return false;\n        // Verificar si hay conflicto de profesor\n        return currentSubjects.some(subject => subject.professorId === newSubject.professorId);\n      } catch (error) {\n        console.error('Error checking professor conflict:', error);\n        return false;\n      }\n    })();\n  }\n  unregisterSubject(registrationId) {\n    if (!registrationId) {\n      this.error = 'ID de registro no válido';\n      return;\n    }\n    if (confirm('¿Estás seguro de que deseas eliminar esta materia?')) {\n      this.loading = true;\n      this.error = '';\n      this.success = '';\n      this.registrationService.unregisterSubject(registrationId).subscribe({\n        next: () => {\n          this.success = 'Materia eliminada correctamente';\n          this.loading = false;\n          // Recargar los datos\n          this.loadCurrentRegistrations();\n          this.loadAvailableSubjects();\n        },\n        error: err => {\n          this.error = 'Error al eliminar la materia';\n          this.loading = false;\n          console.error(err);\n        }\n      });\n    }\n  }\n  // Método para abrir el modal de compañeros\n  openClassmatesModal(subjectId) {\n    if (!subjectId) {\n      this.error = 'Error: No se pudo identificar la materia seleccionada';\n      setTimeout(() => this.error = '', 3000); // Limpiar el mensaje después de 3 segundos\n      return;\n    }\n    this.selectedSubjectId = subjectId;\n    try {\n      // Asegurarse de que Bootstrap esté disponible\n      if (typeof bootstrap === 'undefined') {\n        console.error('Bootstrap no está disponible');\n        this.error = 'Error al mostrar la ventana modal. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n        return;\n      }\n      // Usar Bootstrap 5 para abrir el modal\n      const modalElement = document.getElementById('classmatesModal');\n      if (modalElement) {\n        // Asegurarse de que cualquier modal previo se cierre\n        const existingModal = bootstrap.Modal.getInstance(modalElement);\n        if (existingModal) {\n          existingModal.dispose();\n        }\n        // Crear una nueva instancia del modal con opciones específicas\n        const modalOptions = {\n          backdrop: 'static',\n          keyboard: true,\n          focus: true // Enfoca el modal cuando se abre\n        };\n\n        const modalInstance = new bootstrap.Modal(modalElement, modalOptions);\n        // Asegurarse de que el modal esté visible\n        modalElement.style.display = 'block';\n        modalElement.style.zIndex = '1050';\n        // Mostrar el modal\n        modalInstance.show();\n        // Verificar que el modal se haya abierto correctamente\n        setTimeout(() => {\n          if (modalElement.classList.contains('show')) {\n            console.log('Modal mostrado correctamente');\n          } else {\n            console.error('El modal no se mostró correctamente');\n            this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n            setTimeout(() => this.error = '', 3000);\n          }\n        }, 500);\n      } else {\n        console.error('No se encontró el elemento del modal con ID: classmatesModal');\n        this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n      }\n    } catch (e) {\n      console.error('Error al abrir el modal:', e);\n      this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n      setTimeout(() => this.error = '', 3000);\n    }\n  }\n  static {\n    this.ɵfac = function SubjectRegistrationComponent_Factory(t) {\n      return new (t || SubjectRegistrationComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.SubjectService), i0.ɵɵdirectiveInject(i3.RegistrationService), i0.ɵɵdirectiveInject(i4.AuthService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i6.ModalService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: SubjectRegistrationComponent,\n      selectors: [[\"app-subject-registration\"]],\n      decls: 61,\n      vars: 15,\n      consts: [[1, \"container\", \"mt-4\"], [1, \"row\"], [1, \"col-md-12\"], [\"class\", \"row\", 4, \"ngIf\"], [1, \"row\", \"mb-4\"], [1, \"card\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"card-body\"], [3, \"studentId\"], [\"class\", \"text-center mt-3\", 4, \"ngIf\"], [\"class\", \"table-responsive\", 4, \"ngIf\"], [1, \"card-header\", \"bg-success\", \"text-white\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"mb-3\"], [\"for\", \"subjectId\", 1, \"form-label\"], [\"id\", \"subjectId\", \"formControlName\", \"subjectId\", 1, \"form-select\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"invalid-feedback\", 4, \"ngIf\"], [1, \"d-grid\", \"gap-2\"], [\"type\", \"submit\", 1, \"btn\", \"btn-success\", 3, \"disabled\"], [1, \"bi\", \"bi-plus-circle\"], [1, \"mt-3\", \"small\", \"text-muted\"], [1, \"text-danger\", \"fw-bold\"], [\"class\", \"alert alert-warning mt-3\", 4, \"ngIf\"], [\"id\", \"classmatesModal\", \"tabindex\", \"-1\", \"aria-labelledby\", \"classmatesModalLabel\", \"aria-hidden\", \"true\", \"data-testid\", \"classmates-modal\", 1, \"modal\", \"fade\"], [1, \"modal-dialog\", \"modal-dialog-centered\", \"modal-lg\"], [1, \"modal-content\", \"shadow\"], [1, \"modal-header\", \"bg-primary\", \"text-white\"], [\"id\", \"classmatesModalLabel\", 1, \"modal-title\"], [1, \"bi\", \"bi-people-fill\", \"me-2\"], [\"type\", \"button\", \"data-bs-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"btn-close\", \"btn-close-white\"], [1, \"modal-body\", \"p-4\"], [\"class\", \"alert alert-warning\", 4, \"ngIf\"], [3, \"subjectId\", \"currentStudentId\", 4, \"ngIf\"], [1, \"modal-footer\"], [\"type\", \"button\", \"data-bs-dismiss\", \"modal\", 1, \"btn\", \"btn-secondary\"], [1, \"bi\", \"bi-x-circle\", \"me-1\"], [1, \"col-md-12\", \"text-center\"], [\"role\", \"status\", 1, \"spinner-border\", \"text-primary\"], [1, \"visually-hidden\"], [1, \"alert\", \"alert-danger\"], [1, \"alert\", \"alert-success\"], [1, \"text-center\", \"mt-3\"], [1, \"table-responsive\"], [1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [\"data-testid\", \"ver-companeros-btn\", 1, \"btn\", \"btn-sm\", \"btn-info\", \"me-2\", 3, \"id\", \"click\"], [1, \"bi\", \"bi-people\"], [1, \"btn\", \"btn-sm\", \"btn-danger\", 3, \"click\"], [1, \"bi\", \"bi-trash\"], [3, \"value\"], [1, \"invalid-feedback\"], [1, \"alert\", \"alert-warning\", \"mt-3\"], [1, \"alert\", \"alert-warning\"], [3, \"subjectId\", \"currentStudentId\"]],\n      template: function SubjectRegistrationComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h2\");\n          i0.ɵɵtext(4, \"Registro de Materias\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(5, \"hr\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(6, SubjectRegistrationComponent_div_6_Template, 5, 0, \"div\", 3);\n          i0.ɵɵtemplate(7, SubjectRegistrationComponent_div_7_Template, 4, 1, \"div\", 3);\n          i0.ɵɵtemplate(8, SubjectRegistrationComponent_div_8_Template, 4, 1, \"div\", 3);\n          i0.ɵɵelementStart(9, \"div\", 4)(10, \"div\", 2)(11, \"div\", 5)(12, \"div\", 6)(13, \"h4\");\n          i0.ɵɵtext(14, \"Mis Materias Registradas\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(15, \"div\", 7);\n          i0.ɵɵelement(16, \"app-student-credits\", 8);\n          i0.ɵɵtemplate(17, SubjectRegistrationComponent_div_17_Template, 3, 0, \"div\", 9);\n          i0.ɵɵtemplate(18, SubjectRegistrationComponent_div_18_Template, 14, 1, \"div\", 10);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(19, \"div\", 1)(20, \"div\", 2)(21, \"div\", 5)(22, \"div\", 11)(23, \"h4\");\n          i0.ɵɵtext(24, \"Registrar Nueva Materia\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(25, \"div\", 7)(26, \"form\", 12);\n          i0.ɵɵlistener(\"ngSubmit\", function SubjectRegistrationComponent_Template_form_ngSubmit_26_listener() {\n            return ctx.onSubmit();\n          });\n          i0.ɵɵelementStart(27, \"div\", 13)(28, \"label\", 14);\n          i0.ɵɵtext(29, \"Selecciona una Materia\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(30, \"select\", 15)(31, \"option\", 16);\n          i0.ɵɵtext(32, \"-- Selecciona una materia --\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(33, SubjectRegistrationComponent_option_33_Template, 2, 4, \"option\", 17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(34, SubjectRegistrationComponent_div_34_Template, 2, 0, \"div\", 18);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(35, \"div\", 19)(36, \"button\", 20);\n          i0.ɵɵelement(37, \"i\", 21);\n          i0.ɵɵtext(38, \" Registrar Materia \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(39, \"div\", 22)(40, \"p\");\n          i0.ɵɵtext(41, \"Cada materia tiene un n\\u00FAmero espec\\u00EDfico de cr\\u00E9ditos.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(42, \"p\", 23);\n          i0.ɵɵtext(43, \"No puedes registrar materias que excedan el l\\u00EDmite de 9 cr\\u00E9ditos en total.\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(44, SubjectRegistrationComponent_div_44_Template, 2, 1, \"div\", 24);\n          i0.ɵɵelementEnd()()()()()();\n          i0.ɵɵtext(45, \" - \");\n          i0.ɵɵelementStart(46, \"div\", 25)(47, \"div\", 26)(48, \"div\", 27)(49, \"div\", 28)(50, \"h5\", 29);\n          i0.ɵɵelement(51, \"i\", 30);\n          i0.ɵɵtext(52, \"Compa\\u00F1eros de Clase \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(53, \"button\", 31);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(54, \"div\", 32);\n          i0.ɵɵtemplate(55, SubjectRegistrationComponent_div_55_Template, 2, 0, \"div\", 33);\n          i0.ɵɵtemplate(56, SubjectRegistrationComponent_app_classmates_56_Template, 1, 2, \"app-classmates\", 34);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(57, \"div\", 35)(58, \"button\", 36);\n          i0.ɵɵelement(59, \"i\", 37);\n          i0.ɵɵtext(60, \"Cerrar \");\n          i0.ɵɵelementEnd()()()()();\n        }\n        if (rf & 2) {\n          let tmp_7_0;\n          let tmp_9_0;\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.error);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.success);\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"studentId\", ctx.studentId);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.currentRegistrations.length === 0);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.currentRegistrations.length > 0);\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"formGroup\", ctx.registrationForm);\n          i0.ɵɵadvance(4);\n          i0.ɵɵclassProp(\"is-invalid\", ((tmp_7_0 = ctx.registrationForm.get(\"subjectId\")) == null ? null : tmp_7_0.invalid) && ((tmp_7_0 = ctx.registrationForm.get(\"subjectId\")) == null ? null : tmp_7_0.touched));\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngForOf\", ctx.availableSubjects);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ((tmp_9_0 = ctx.registrationForm.get(\"subjectId\")) == null ? null : tmp_9_0.invalid) && ((tmp_9_0 = ctx.registrationForm.get(\"subjectId\")) == null ? null : tmp_9_0.touched));\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", ctx.registrationForm.invalid || ctx.loading || ctx.currentRegistrations.length >= ctx.maxSubjects);\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"ngIf\", ctx.currentRegistrations.length >= ctx.maxSubjects);\n          i0.ɵɵadvance(11);\n          i0.ɵɵproperty(\"ngIf\", !ctx.selectedSubjectId);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedSubjectId);\n        }\n      },\n      dependencies: [i7.NgForOf, i7.NgIf, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i8.StudentCreditsComponent, i9.ClassmatesComponent],\n      styles: [\".card[_ngcontent-%COMP%] {\\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\\n  margin-bottom: 20px;\\n}\\n\\n.card-header[_ngcontent-%COMP%] {\\n  font-weight: bold;\\n}\\n\\n.table[_ngcontent-%COMP%] {\\n  margin-bottom: 0;\\n}\\n\\n.btn-success[_ngcontent-%COMP%] {\\n  transition: all 0.3s;\\n}\\n\\n.btn-success[_ngcontent-%COMP%]:hover {\\n  transform: translateY(-2px);\\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\\n}\\n\\n.alert[_ngcontent-%COMP%] {\\n  margin-top: 15px;\\n}\\n\\n\\n.modal-content[_ngcontent-%COMP%] {\\n  border-radius: 8px;\\n  border: none;\\n}\\n\\n.modal-header[_ngcontent-%COMP%] {\\n  border-top-left-radius: 8px;\\n  border-top-right-radius: 8px;\\n}\\n\\n.modal-dialog[_ngcontent-%COMP%] {\\n  max-width: 600px;\\n}\\n\\n\\n.modal[_ngcontent-%COMP%] {\\n  z-index: 1050 !important;\\n}\\n\\n.modal-backdrop[_ngcontent-%COMP%] {\\n  z-index: 1040 !important;\\n}\\n\\n\\n@media (max-width: 768px) {\\n  .card-body[_ngcontent-%COMP%] {\\n    padding: 1rem;\\n  }\\n  \\n  .table[_ngcontent-%COMP%] {\\n    font-size: 0.9rem;\\n  }\\n  \\n  .btn-sm[_ngcontent-%COMP%] {\\n    padding: 0.25rem 0.5rem;\\n    font-size: 0.75rem;\\n  }\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9zdWJqZWN0LXJlZ2lzdHJhdGlvbi9zdWJqZWN0LXJlZ2lzdHJhdGlvbi5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0Usd0NBQXdDO0VBQ3hDLG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFLGlCQUFpQjtBQUNuQjs7QUFFQTtFQUNFLGdCQUFnQjtBQUNsQjs7QUFFQTtFQUNFLG9CQUFvQjtBQUN0Qjs7QUFFQTtFQUNFLDJCQUEyQjtFQUMzQix3Q0FBd0M7QUFDMUM7O0FBRUE7RUFDRSxnQkFBZ0I7QUFDbEI7O0FBRUEsMEJBQTBCO0FBQzFCO0VBQ0Usa0JBQWtCO0VBQ2xCLFlBQVk7QUFDZDs7QUFFQTtFQUNFLDJCQUEyQjtFQUMzQiw0QkFBNEI7QUFDOUI7O0FBRUE7RUFDRSxnQkFBZ0I7QUFDbEI7O0FBRUEsNkRBQTZEO0FBQzdEO0VBQ0Usd0JBQXdCO0FBQzFCOztBQUVBO0VBQ0Usd0JBQXdCO0FBQzFCOztBQUVBLHNDQUFzQztBQUN0QztFQUNFO0lBQ0UsYUFBYTtFQUNmOztFQUVBO0lBQ0UsaUJBQWlCO0VBQ25COztFQUVBO0lBQ0UsdUJBQXVCO0lBQ3ZCLGtCQUFrQjtFQUNwQjtBQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLmNhcmQge1xuICBib3gtc2hhZG93OiAwIDRweCA4cHggcmdiYSgwLCAwLCAwLCAwLjEpO1xuICBtYXJnaW4tYm90dG9tOiAyMHB4O1xufVxuXG4uY2FyZC1oZWFkZXIge1xuICBmb250LXdlaWdodDogYm9sZDtcbn1cblxuLnRhYmxlIHtcbiAgbWFyZ2luLWJvdHRvbTogMDtcbn1cblxuLmJ0bi1zdWNjZXNzIHtcbiAgdHJhbnNpdGlvbjogYWxsIDAuM3M7XG59XG5cbi5idG4tc3VjY2Vzczpob3ZlciB7XG4gIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMnB4KTtcbiAgYm94LXNoYWRvdzogMCA0cHggOHB4IHJnYmEoMCwgMCwgMCwgMC4yKTtcbn1cblxuLmFsZXJ0IHtcbiAgbWFyZ2luLXRvcDogMTVweDtcbn1cblxuLyogRXN0aWxvcyBwYXJhIGVsIG1vZGFsICovXG4ubW9kYWwtY29udGVudCB7XG4gIGJvcmRlci1yYWRpdXM6IDhweDtcbiAgYm9yZGVyOiBub25lO1xufVxuXG4ubW9kYWwtaGVhZGVyIHtcbiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogOHB4O1xuICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogOHB4O1xufVxuXG4ubW9kYWwtZGlhbG9nIHtcbiAgbWF4LXdpZHRoOiA2MDBweDtcbn1cblxuLyogQXNlZ3VyYXIgcXVlIGVsIG1vZGFsIGVzdMODwqkgcG9yIGVuY2ltYSBkZSBvdHJvcyBlbGVtZW50b3MgKi9cbi5tb2RhbCB7XG4gIHotaW5kZXg6IDEwNTAgIWltcG9ydGFudDtcbn1cblxuLm1vZGFsLWJhY2tkcm9wIHtcbiAgei1pbmRleDogMTA0MCAhaW1wb3J0YW50O1xufVxuXG4vKiBFc3RpbG9zIHBhcmEgZGlzcG9zaXRpdm9zIG3Dg8KzdmlsZXMgKi9cbkBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkge1xuICAuY2FyZC1ib2R5IHtcbiAgICBwYWRkaW5nOiAxcmVtO1xuICB9XG4gIFxuICAudGFibGUge1xuICAgIGZvbnQtc2l6ZTogMC45cmVtO1xuICB9XG4gIFxuICAuYnRuLXNtIHtcbiAgICBwYWRkaW5nOiAwLjI1cmVtIDAuNXJlbTtcbiAgICBmb250LXNpemU6IDAuNzVyZW07XG4gIH1cbn0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["Validators","firstValueFrom","i0","SubjectRegistrationComponent","constructor","formBuilder","subjectService","registrationService","authService","router","modalService","ngOnInit","initForm","getCurrentStudentId","registrationForm","group","subjectId","required","get","valueChanges","subscribe","selectedSubject","availableSubjects","find","s","id","selectedSubjectCredits","credits","checkCreditLimit","wouldExceedCreditLimit","currentTotalCredits","maxCredits","loading","getCurrentUser","next","user","studentId","loadCurrentRegistrations","loadAvailableSubjects","error","err","console","getStudentRegistrations","registrations","currentRegistrations","loadCurrentCredits","getStudentTotalCredits","getSubjects","subjects","registeredSubjectIds","map","reg","filter","subject","includes","onSubmit","invalid","success","value","length","maxSubjects","currentCredits","checkProfessorConflict","then","hasConflict","registrationRequest","studentName","getCurrentUserValue","name","subjectName","registerSubject","registration","reset","message","catch","newSubjectId","newSubject","getSubject","currentSubjectIds","currentSubjects","getSubjectsByIds","some","professorId","unregisterSubject","registrationId","confirm","openClassmatesModal","setTimeout","selectedSubjectId","bootstrap","modalElement","document","getElementById","existingModal","Modal","getInstance","dispose","modalOptions","backdrop","keyboard","focus","modalInstance","style","display","zIndex","show","classList","contains","log","e","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\hansk\\Videos\\frontendsistemacolegio.interrapidisi\\frontendsistemacolegio.interrapidisi\\src\\app\\components\\subject-registration\\subject-registration.component.ts","C:\\Users\\hansk\\Videos\\frontendsistemacolegio.interrapidisi\\frontendsistemacolegio.interrapidisi\\src\\app\\components\\subject-registration\\subject-registration.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Subject } from '../../models/subject.model';\nimport { Registration, RegistrationRequest } from '../../models/registration.model';\nimport { SubjectService } from '../../services/subject.service';\nimport { RegistrationService } from '../../services/registration.service';\nimport { AuthService } from '../../services/auth.service';\nimport { Router } from '@angular/router';\nimport { firstValueFrom } from 'rxjs';\nimport { ModalService } from '../../services/modal.service';\n\n// Declaración para el objeto bootstrap global\ndeclare var bootstrap: any;\n\n@Component({\n  selector: 'app-subject-registration',\n  templateUrl: './subject-registration.component.html',\n  styleUrls: ['./subject-registration.component.css']\n})\nexport class SubjectRegistrationComponent implements OnInit {\n  registrationForm!: FormGroup;\n  availableSubjects: Subject[] = [];\n  currentRegistrations: Registration[] = [];\n  loading = false;\n  error = '';\n  success = '';\n  studentId: number = 0;\n  maxSubjects = 3;\n  selectedSubjectId: number | null = null; // Para el modal de compañeros\n  currentTotalCredits = 0;\n  maxCredits = 9;\n  selectedSubjectCredits = 0;\n  wouldExceedCreditLimit = false;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private subjectService: SubjectService,\n    private registrationService: RegistrationService,\n    private authService: AuthService,\n    private router: Router,\n    private modalService: ModalService\n  ) {}\n\n  ngOnInit(): void {\n    this.initForm();\n    this.getCurrentStudentId();\n  }\n\n  initForm(): void {\n    this.registrationForm = this.formBuilder.group({\n      subjectId: ['', [Validators.required]]\n    });\n\n    // Escuchar cambios en la selecciu00f3n de materia\n    this.registrationForm.get('subjectId')?.valueChanges.subscribe(subjectId => {\n      if (subjectId) {\n        const selectedSubject = this.availableSubjects.find(s => s.id === +subjectId);\n        if (selectedSubject) {\n          this.selectedSubjectCredits = selectedSubject.credits;\n          this.checkCreditLimit();\n        }\n      } else {\n        this.selectedSubjectCredits = 0;\n        this.wouldExceedCreditLimit = false;\n      }\n    });\n  }\n\n  checkCreditLimit(): void {\n    if (this.selectedSubjectCredits > 0) {\n      this.wouldExceedCreditLimit = (this.currentTotalCredits + this.selectedSubjectCredits) > this.maxCredits;\n    } else {\n      this.wouldExceedCreditLimit = false;\n    }\n  }\n\n  getCurrentStudentId(): void {\n    this.loading = true;\n    this.authService.getCurrentUser().subscribe({\n      next: (user) => {\n        if (user && user.id) {\n          this.studentId = user.id;\n          this.loadCurrentRegistrations();\n          this.loadAvailableSubjects();\n        } else {\n          this.error = 'No se pudo obtener la información del estudiante';\n          this.loading = false;\n        }\n      },\n      error: (err) => {\n        this.error = 'Error al obtener información del usuario';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n\n  loadCurrentRegistrations(): void {\n    this.registrationService.getStudentRegistrations(this.studentId).subscribe({\n      next: (registrations) => {\n        this.currentRegistrations = registrations;\n        this.loading = false;\n        \n        // Cargar los créditos actuales\n        this.loadCurrentCredits();\n      },\n      error: (err) => {\n        this.error = 'Error al cargar registros actuales';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n\n  loadCurrentCredits(): void {\n    this.registrationService.getStudentTotalCredits(this.studentId).subscribe({\n      next: (credits) => {\n        this.currentTotalCredits = credits;\n        this.checkCreditLimit();\n      },\n      error: (err) => {\n        console.error('Error al cargar créditos actuales:', err);\n      }\n    });\n  }\n\n  loadAvailableSubjects(): void {\n    this.subjectService.getSubjects().subscribe({\n      next: (subjects) => {\n        // Filtrar materias ya registradas\n        const registeredSubjectIds = this.currentRegistrations.map(reg => reg.subjectId);\n        this.availableSubjects = subjects.filter(subject => !registeredSubjectIds.includes(subject.id));\n        this.loading = false;\n      },\n      error: (err) => {\n        this.error = 'Error al cargar materias disponibles';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n\n  onSubmit(): void {\n    if (this.registrationForm.invalid) {\n      return;\n    }\n\n    this.loading = true;\n    this.error = '';\n    this.success = '';\n\n    const subjectId = this.registrationForm.value.subjectId;\n    \n    // Verificar si ya tiene el máximo de materias\n    if (this.currentRegistrations.length >= this.maxSubjects) {\n      this.error = `No puedes registrar más de ${this.maxSubjects} materias`;\n      this.loading = false;\n      return;\n    }\n\n    // Obtener la materia seleccionada\n    const selectedSubject = this.availableSubjects.find(s => s.id === subjectId);\n    if (!selectedSubject) {\n      this.error = 'No se encontró la materia seleccionada';\n      this.loading = false;\n      return;\n    }\n\n    // Verificar si al agregar esta materia se excede el límite de 9 créditos\n    this.registrationService.getStudentTotalCredits(this.studentId).subscribe({\n      next: (currentCredits) => {\n        // Verificar si al agregar esta materia se excede el límite de 9 créditos\n        if (currentCredits + selectedSubject.credits > 9) {\n          this.error = `No puedes registrar esta materia porque excederías el límite de 9 créditos. Actualmente tienes ${currentCredits} créditos y esta materia tiene ${selectedSubject.credits} créditos.`;\n          this.loading = false;\n          return;\n        }\n\n        // Verificar si ya tiene una materia con el mismo profesor\n        this.checkProfessorConflict(subjectId).then(hasConflict => {\n          if (hasConflict) {\n            this.error = 'No puedes tener más de una materia con el mismo profesor';\n            this.loading = false;\n            return;\n          }\n\n          // Proceder con el registro\n          const registrationRequest: RegistrationRequest = {\n            studentId: this.studentId,\n            subjectId: subjectId,\n            studentName: this.authService.getCurrentUserValue()?.name || '',\n            subjectName: selectedSubject.name || ''\n          };\n\n          this.registrationService.registerSubject(registrationRequest).subscribe({\n            next: (registration) => {\n              this.success = 'Materia registrada correctamente';\n              this.loading = false;\n              this.registrationForm.reset();\n              // Recargar los datos\n              this.loadCurrentRegistrations();\n              this.loadAvailableSubjects();\n            },\n            error: (err) => {\n              this.error = err.message || 'Error al registrar la materia';\n              this.loading = false;\n              console.error(err);\n            }\n          });\n        }).catch(err => {\n          this.error = 'Error al verificar conflictos de profesor';\n          this.loading = false;\n          console.error(err);\n        });\n      },\n      error: (err) => {\n        this.error = 'Error al verificar los créditos actuales';\n        this.loading = false;\n        console.error(err);\n      }\n    });\n  }\n\n  async checkProfessorConflict(newSubjectId: number): Promise<boolean> {\n    // Si no hay registros actuales, no hay conflicto\n    if (this.currentRegistrations.length === 0) {\n      return false;\n    }\n\n    try {\n      // Obtener la nueva materia\n      const newSubject = await firstValueFrom(this.subjectService.getSubject(newSubjectId));\n      if (!newSubject) return false;\n\n      // Obtener las materias actuales\n      const currentSubjectIds = this.currentRegistrations.map(reg => reg.subjectId);\n      const currentSubjects = await firstValueFrom(this.subjectService.getSubjectsByIds(currentSubjectIds));\n      if (!currentSubjects) return false;\n\n      // Verificar si hay conflicto de profesor\n      return currentSubjects.some(subject => subject.professorId === newSubject.professorId);\n    } catch (error) {\n      console.error('Error checking professor conflict:', error);\n      return false;\n    }\n  }\n\n  unregisterSubject(registrationId: number | undefined): void {\n    if (!registrationId) {\n      this.error = 'ID de registro no válido';\n      return;\n    }\n    \n    if (confirm('¿Estás seguro de que deseas eliminar esta materia?')) {\n      this.loading = true;\n      this.error = '';\n      this.success = '';\n\n      this.registrationService.unregisterSubject(registrationId).subscribe({\n        next: () => {\n          this.success = 'Materia eliminada correctamente';\n          this.loading = false;\n          // Recargar los datos\n          this.loadCurrentRegistrations();\n          this.loadAvailableSubjects();\n        },\n        error: (err) => {\n          this.error = 'Error al eliminar la materia';\n          this.loading = false;\n          console.error(err);\n        }\n      });\n    }\n  }\n\n  // Método para abrir el modal de compañeros\n  openClassmatesModal(subjectId: number): void {\n    if (!subjectId) {\n      this.error = 'Error: No se pudo identificar la materia seleccionada';\n      setTimeout(() => this.error = '', 3000); // Limpiar el mensaje después de 3 segundos\n      return;\n    }\n    \n    this.selectedSubjectId = subjectId;\n    \n    try {\n      // Asegurarse de que Bootstrap esté disponible\n      if (typeof bootstrap === 'undefined') {\n        console.error('Bootstrap no está disponible');\n        this.error = 'Error al mostrar la ventana modal. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n        return;\n      }\n      \n      // Usar Bootstrap 5 para abrir el modal\n      const modalElement: HTMLElement | null = document.getElementById('classmatesModal');\n      if (modalElement) {\n        // Asegurarse de que cualquier modal previo se cierre\n        const existingModal = bootstrap.Modal.getInstance(modalElement);\n        if (existingModal) {\n          existingModal.dispose();\n        }\n        \n        // Crear una nueva instancia del modal con opciones específicas\n        const modalOptions = {\n          backdrop: 'static',  // El modal no se cierra al hacer clic fuera\n          keyboard: true,     // Se puede cerrar con la tecla ESC\n          focus: true         // Enfoca el modal cuando se abre\n        };\n        \n        const modalInstance = new bootstrap.Modal(modalElement, modalOptions);\n        \n        // Asegurarse de que el modal esté visible\n        modalElement.style.display = 'block';\n        modalElement.style.zIndex = '1050';\n        \n        // Mostrar el modal\n        modalInstance.show();\n        \n        // Verificar que el modal se haya abierto correctamente\n        setTimeout(() => {\n          if (modalElement.classList.contains('show')) {\n            console.log('Modal mostrado correctamente');\n          } else {\n            console.error('El modal no se mostró correctamente');\n            this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n            setTimeout(() => this.error = '', 3000);\n          }\n        }, 500);\n      } else {\n        console.error('No se encontró el elemento del modal con ID: classmatesModal');\n        this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n        setTimeout(() => this.error = '', 3000);\n      }\n    } catch (e) {\n      console.error('Error al abrir el modal:', e);\n      this.error = 'Error al mostrar la lista de compañeros. Intente nuevamente.';\n      setTimeout(() => this.error = '', 3000);\n    }\n  }\n}","  <div class=\"container mt-4\">\n  <div class=\"row\">\n    <div class=\"col-md-12\">\n      <h2>Registro de Materias</h2>\n      <hr>\n    </div>\n  </div>\n\n  <div class=\"row\" *ngIf=\"loading\">\n    <div class=\"col-md-12 text-center\">\n      <div class=\"spinner-border text-primary\" role=\"status\">\n        <span class=\"visually-hidden\">Cargando...</span>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"row\" *ngIf=\"error\">\n    <div class=\"col-md-12\">\n      <div class=\"alert alert-danger\">\n        {{ error }}\n      </div>\n    </div>\n  </div>\n\n  <div class=\"row\" *ngIf=\"success\">\n    <div class=\"col-md-12\">\n      <div class=\"alert alert-success\">\n        {{ success }}\n      </div>\n    </div>\n  </div>\n\n  <!-- Materias Actuales -->\n   <div class=\"row mb-4\">\n    <div class=\"col-md-12\">\n      <div class=\"card\">\n        <div class=\"card-header bg-primary text-white\">\n          <h4>Mis Materias Registradas</h4>\n        </div>\n        <div class=\"card-body\">\n          <app-student-credits [studentId]=\"studentId\"></app-student-credits>\n          \n          <div *ngIf=\"currentRegistrations.length === 0\" class=\"text-center mt-3\">\n            <p>No tienes materias registradas.</p>\n          </div>\n          \n          <div *ngIf=\"currentRegistrations.length > 0\" class=\"table-responsive\">\n            <table class=\"table table-striped\">\n              <thead>\n                <tr>\n                  <th>Materia</th>\n                  <th>Profesor</th>\n                  <th>Créditos</th>\n                  <th>Acciones</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let reg of currentRegistrations\">\n                  <td>{{ reg.subject?.name }}</td>\n                  <td>{{ reg.subject?.professor?.name }}</td>\n                  <td>{{ reg.subject?.credits }}</td>\n                  <td>\n                    <button class=\"btn btn-sm btn-info me-2\" (click)=\"openClassmatesModal(reg.subjectId)\" id=\"btnVerCompaneros-{{reg.subjectId}}\" data-testid=\"ver-companeros-btn\">\n                      <i class=\"bi bi-people\"></i> Ver Compañeros\n                    </button>\n                    <button class=\"btn btn-sm btn-danger\" (click)=\"unregisterSubject(reg.id)\">\n                      <i class=\"bi bi-trash\"></i> Eliminar\n                    </button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div> \n\n  <!-- Formulario de Registro -->\n   <div class=\"row\">\n    <div class=\"col-md-12\">\n      <div class=\"card\">\n        <div class=\"card-header bg-success text-white\">\n          <h4>Registrar Nueva Materia</h4>\n        </div>\n        <div class=\"card-body\">\n          <form [formGroup]=\"registrationForm\" (ngSubmit)=\"onSubmit()\">\n            <div class=\"mb-3\">\n              <label for=\"subjectId\" class=\"form-label\">Selecciona una Materia</label>\n              <select id=\"subjectId\" formControlName=\"subjectId\" class=\"form-select\" \n                      [class.is-invalid]=\"registrationForm.get('subjectId')?.invalid && registrationForm.get('subjectId')?.touched\">\n                <option value=\"\">-- Selecciona una materia --</option>\n                <option *ngFor=\"let subject of availableSubjects\" [value]=\"subject.id\">\n                  {{ subject.name }} - Prof. {{ subject.professor?.name }} ({{ subject.credits }} créditos)\n                </option>\n              </select>\n              <div *ngIf=\"registrationForm.get('subjectId')?.invalid && registrationForm.get('subjectId')?.touched\" class=\"invalid-feedback\">\n                Debes seleccionar una materia.\n              </div>\n            </div>\n            \n            <div class=\"d-grid gap-2\">\n              <button type=\"submit\" class=\"btn btn-success\" [disabled]=\"registrationForm.invalid || loading || currentRegistrations.length >= maxSubjects\">\n                <i class=\"bi bi-plus-circle\"></i> Registrar Materia\n              </button>\n            </div>\n            \n            <div class=\"mt-3 small text-muted\">\n              <p>Cada materia tiene un número específico de créditos.</p>\n              <p class=\"text-danger fw-bold\">No puedes registrar materias que excedan el límite de 9 créditos en total.</p>\n            </div>\n            \n            <div *ngIf=\"currentRegistrations.length >= maxSubjects\" class=\"alert alert-warning mt-3\">\n              Has alcanzado el límite máximo de {{ maxSubjects }} materias.\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</div> -\n\n<!-- Modal para mostrar compañeros -->\n <div class=\"modal fade\" id=\"classmatesModal\" tabindex=\"-1\" aria-labelledby=\"classmatesModalLabel\" aria-hidden=\"true\" data-testid=\"classmates-modal\">\n  <div class=\"modal-dialog modal-dialog-centered modal-lg\">\n    <div class=\"modal-content shadow\">\n      <div class=\"modal-header bg-primary text-white\">\n        <h5 class=\"modal-title\" id=\"classmatesModalLabel\">\n          <i class=\"bi bi-people-fill me-2\"></i>Compañeros de Clase\n        </h5>\n        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n      </div>\n      <div class=\"modal-body p-4\">\n        <div *ngIf=\"!selectedSubjectId\" class=\"alert alert-warning\">\n          No se ha seleccionado ninguna materia.\n        </div>\n        <app-classmates *ngIf=\"selectedSubjectId\" [subjectId]=\"selectedSubjectId\" [currentStudentId]=\"studentId\"></app-classmates>\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">\n          <i class=\"bi bi-x-circle me-1\"></i>Cerrar\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n  "]},"metadata":{},"sourceType":"module","externalDependencies":[]}